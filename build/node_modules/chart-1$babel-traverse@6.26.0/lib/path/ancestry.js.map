{"version":3,"sources":["ancestry.js"],"names":["exports","__esModule","_getIterator2","require","_getIterator3","_interopRequireDefault","findParent","find","getFunctionParent","getStatementParent","getEarliestCommonAncestorFrom","getDeepestCommonAncestorFrom","getAncestry","isAncestor","isDescendant","inType","inShadow","_babelTypes","t","_interopRequireWildcard","_index","_index2","obj","newObj","key","Object","prototype","hasOwnProperty","call","default","callback","path","parentPath","isFunction","isProgram","Array","isArray","container","paths","deepest","i","ancestries","earliest","keys","VISITOR_KEYS","type","_iterator","_isArray","_i","_ref","length","next","done","value","ancestry","listKey","earliestKeyIndex","indexOf","parentKey","currentKeyIndex","filter","_this","minDepth","Infinity","lastCommonIndex","lastCommon","map","unshift","first","depthLoop","shouldMatch","_iterator2","_isArray2","_i2","_ref2","Error","push","maybeDescendant","maybeAncestor","parent","_iterator3","arguments","_isArray3","_i3","_ref3","node","parentFn","p","isFunctionExpression","isFunctionDeclaration","shadow","isArrowFunctionExpression"],"mappings":"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","file":"ancestry.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nexports.findParent = findParent;\nexports.find = find;\nexports.getFunctionParent = getFunctionParent;\nexports.getStatementParent = getStatementParent;\nexports.getEarliestCommonAncestorFrom = getEarliestCommonAncestorFrom;\nexports.getDeepestCommonAncestorFrom = getDeepestCommonAncestorFrom;\nexports.getAncestry = getAncestry;\nexports.isAncestor = isAncestor;\nexports.isDescendant = isDescendant;\nexports.inType = inType;\nexports.inShadow = inShadow;\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nvar _index = require(\"./index\");\n\nvar _index2 = _interopRequireDefault(_index);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction findParent(callback) {\n  var path = this;\n  while (path = path.parentPath) {\n    if (callback(path)) return path;\n  }\n  return null;\n}\n\nfunction find(callback) {\n  var path = this;\n  do {\n    if (callback(path)) return path;\n  } while (path = path.parentPath);\n  return null;\n}\n\nfunction getFunctionParent() {\n  return this.findParent(function (path) {\n    return path.isFunction() || path.isProgram();\n  });\n}\n\nfunction getStatementParent() {\n  var path = this;\n  do {\n    if (Array.isArray(path.container)) {\n      return path;\n    }\n  } while (path = path.parentPath);\n}\n\nfunction getEarliestCommonAncestorFrom(paths) {\n  return this.getDeepestCommonAncestorFrom(paths, function (deepest, i, ancestries) {\n    var earliest = void 0;\n    var keys = t.VISITOR_KEYS[deepest.type];\n\n    for (var _iterator = ancestries, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : (0, _getIterator3.default)(_iterator);;) {\n      var _ref;\n\n      if (_isArray) {\n        if (_i >= _iterator.length) break;\n        _ref = _iterator[_i++];\n      } else {\n        _i = _iterator.next();\n        if (_i.done) break;\n        _ref = _i.value;\n      }\n\n      var ancestry = _ref;\n\n      var path = ancestry[i + 1];\n\n      if (!earliest) {\n        earliest = path;\n        continue;\n      }\n\n      if (path.listKey && earliest.listKey === path.listKey) {\n        if (path.key < earliest.key) {\n          earliest = path;\n          continue;\n        }\n      }\n\n      var earliestKeyIndex = keys.indexOf(earliest.parentKey);\n      var currentKeyIndex = keys.indexOf(path.parentKey);\n      if (earliestKeyIndex > currentKeyIndex) {\n        earliest = path;\n      }\n    }\n\n    return earliest;\n  });\n}\n\nfunction getDeepestCommonAncestorFrom(paths, filter) {\n  var _this = this;\n\n  if (!paths.length) {\n    return this;\n  }\n\n  if (paths.length === 1) {\n    return paths[0];\n  }\n\n  var minDepth = Infinity;\n\n  var lastCommonIndex = void 0,\n      lastCommon = void 0;\n\n  var ancestries = paths.map(function (path) {\n    var ancestry = [];\n\n    do {\n      ancestry.unshift(path);\n    } while ((path = path.parentPath) && path !== _this);\n\n    if (ancestry.length < minDepth) {\n      minDepth = ancestry.length;\n    }\n\n    return ancestry;\n  });\n\n  var first = ancestries[0];\n\n  depthLoop: for (var i = 0; i < minDepth; i++) {\n    var shouldMatch = first[i];\n\n    for (var _iterator2 = ancestries, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : (0, _getIterator3.default)(_iterator2);;) {\n      var _ref2;\n\n      if (_isArray2) {\n        if (_i2 >= _iterator2.length) break;\n        _ref2 = _iterator2[_i2++];\n      } else {\n        _i2 = _iterator2.next();\n        if (_i2.done) break;\n        _ref2 = _i2.value;\n      }\n\n      var ancestry = _ref2;\n\n      if (ancestry[i] !== shouldMatch) {\n        break depthLoop;\n      }\n    }\n\n    lastCommonIndex = i;\n    lastCommon = shouldMatch;\n  }\n\n  if (lastCommon) {\n    if (filter) {\n      return filter(lastCommon, lastCommonIndex, ancestries);\n    } else {\n      return lastCommon;\n    }\n  } else {\n    throw new Error(\"Couldn't find intersection\");\n  }\n}\n\nfunction getAncestry() {\n  var path = this;\n  var paths = [];\n  do {\n    paths.push(path);\n  } while (path = path.parentPath);\n  return paths;\n}\n\nfunction isAncestor(maybeDescendant) {\n  return maybeDescendant.isDescendant(this);\n}\n\nfunction isDescendant(maybeAncestor) {\n  return !!this.findParent(function (parent) {\n    return parent === maybeAncestor;\n  });\n}\n\nfunction inType() {\n  var path = this;\n  while (path) {\n    for (var _iterator3 = arguments, _isArray3 = Array.isArray(_iterator3), _i3 = 0, _iterator3 = _isArray3 ? _iterator3 : (0, _getIterator3.default)(_iterator3);;) {\n      var _ref3;\n\n      if (_isArray3) {\n        if (_i3 >= _iterator3.length) break;\n        _ref3 = _iterator3[_i3++];\n      } else {\n        _i3 = _iterator3.next();\n        if (_i3.done) break;\n        _ref3 = _i3.value;\n      }\n\n      var type = _ref3;\n\n      if (path.node.type === type) return true;\n    }\n    path = path.parentPath;\n  }\n\n  return false;\n}\n\nfunction inShadow(key) {\n  var parentFn = this.isFunction() ? this : this.findParent(function (p) {\n    return p.isFunction();\n  });\n  if (!parentFn) return;\n\n  if (parentFn.isFunctionExpression() || parentFn.isFunctionDeclaration()) {\n    var shadow = parentFn.node.shadow;\n\n    if (shadow && (!key || shadow[key] !== false)) {\n      return parentFn;\n    }\n  } else if (parentFn.isArrowFunctionExpression()) {\n    return parentFn;\n  }\n\n  return null;\n}"]}