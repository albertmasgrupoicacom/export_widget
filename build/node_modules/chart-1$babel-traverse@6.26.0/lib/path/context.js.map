{"version":3,"sources":["context.js"],"names":["exports","__esModule","_getIterator2","require","_getIterator3","_interopRequireDefault","call","_call","isBlacklisted","visit","skip","skipKey","stop","setScope","setContext","resync","_resyncParent","_resyncKey","_resyncList","_resyncRemoved","popContext","pushContext","setup","setKey","requeue","_getQueueContexts","_index","_index2","obj","default","key","opts","debug","node","type","fns","_iterator","_isArray","Array","isArray","_i","_ref","length","next","done","value","fn","ret","state","Error","shouldStop","shouldSkip","removed","blacklist","indexOf","scope","skipKeys","noScope","target","context","path","parentPath","getScope","init","parent","container","i","inList","newContainer","listKey","_markRemoved","contexts","pop","push","parentKey","pathToQueue","arguments","undefined","_iterator2","_isArray2","_i2","_ref2","maybeQueue"],"mappings":"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","file":"context.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nexports.call = call;\nexports._call = _call;\nexports.isBlacklisted = isBlacklisted;\nexports.visit = visit;\nexports.skip = skip;\nexports.skipKey = skipKey;\nexports.stop = stop;\nexports.setScope = setScope;\nexports.setContext = setContext;\nexports.resync = resync;\nexports._resyncParent = _resyncParent;\nexports._resyncKey = _resyncKey;\nexports._resyncList = _resyncList;\nexports._resyncRemoved = _resyncRemoved;\nexports.popContext = popContext;\nexports.pushContext = pushContext;\nexports.setup = setup;\nexports.setKey = setKey;\nexports.requeue = requeue;\nexports._getQueueContexts = _getQueueContexts;\n\nvar _index = require(\"../index\");\n\nvar _index2 = _interopRequireDefault(_index);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction call(key) {\n  var opts = this.opts;\n\n  this.debug(function () {\n    return key;\n  });\n\n  if (this.node) {\n    if (this._call(opts[key])) return true;\n  }\n\n  if (this.node) {\n    return this._call(opts[this.node.type] && opts[this.node.type][key]);\n  }\n\n  return false;\n}\n\nfunction _call(fns) {\n  if (!fns) return false;\n\n  for (var _iterator = fns, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : (0, _getIterator3.default)(_iterator);;) {\n    var _ref;\n\n    if (_isArray) {\n      if (_i >= _iterator.length) break;\n      _ref = _iterator[_i++];\n    } else {\n      _i = _iterator.next();\n      if (_i.done) break;\n      _ref = _i.value;\n    }\n\n    var fn = _ref;\n\n    if (!fn) continue;\n\n    var node = this.node;\n    if (!node) return true;\n\n    var ret = fn.call(this.state, this, this.state);\n    if (ret) throw new Error(\"Unexpected return value from visitor method \" + fn);\n\n    if (this.node !== node) return true;\n\n    if (this.shouldStop || this.shouldSkip || this.removed) return true;\n  }\n\n  return false;\n}\n\nfunction isBlacklisted() {\n  var blacklist = this.opts.blacklist;\n  return blacklist && blacklist.indexOf(this.node.type) > -1;\n}\n\nfunction visit() {\n  if (!this.node) {\n    return false;\n  }\n\n  if (this.isBlacklisted()) {\n    return false;\n  }\n\n  if (this.opts.shouldSkip && this.opts.shouldSkip(this)) {\n    return false;\n  }\n\n  if (this.call(\"enter\") || this.shouldSkip) {\n    this.debug(function () {\n      return \"Skip...\";\n    });\n    return this.shouldStop;\n  }\n\n  this.debug(function () {\n    return \"Recursing into...\";\n  });\n  _index2.default.node(this.node, this.opts, this.scope, this.state, this, this.skipKeys);\n\n  this.call(\"exit\");\n\n  return this.shouldStop;\n}\n\nfunction skip() {\n  this.shouldSkip = true;\n}\n\nfunction skipKey(key) {\n  this.skipKeys[key] = true;\n}\n\nfunction stop() {\n  this.shouldStop = true;\n  this.shouldSkip = true;\n}\n\nfunction setScope() {\n  if (this.opts && this.opts.noScope) return;\n\n  var target = this.context && this.context.scope;\n\n  if (!target) {\n    var path = this.parentPath;\n    while (path && !target) {\n      if (path.opts && path.opts.noScope) return;\n\n      target = path.scope;\n      path = path.parentPath;\n    }\n  }\n\n  this.scope = this.getScope(target);\n  if (this.scope) this.scope.init();\n}\n\nfunction setContext(context) {\n  this.shouldSkip = false;\n  this.shouldStop = false;\n  this.removed = false;\n  this.skipKeys = {};\n\n  if (context) {\n    this.context = context;\n    this.state = context.state;\n    this.opts = context.opts;\n  }\n\n  this.setScope();\n\n  return this;\n}\n\nfunction resync() {\n  if (this.removed) return;\n\n  this._resyncParent();\n  this._resyncList();\n  this._resyncKey();\n}\n\nfunction _resyncParent() {\n  if (this.parentPath) {\n    this.parent = this.parentPath.node;\n  }\n}\n\nfunction _resyncKey() {\n  if (!this.container) return;\n\n  if (this.node === this.container[this.key]) return;\n\n  if (Array.isArray(this.container)) {\n    for (var i = 0; i < this.container.length; i++) {\n      if (this.container[i] === this.node) {\n        return this.setKey(i);\n      }\n    }\n  } else {\n    for (var key in this.container) {\n      if (this.container[key] === this.node) {\n        return this.setKey(key);\n      }\n    }\n  }\n\n  this.key = null;\n}\n\nfunction _resyncList() {\n  if (!this.parent || !this.inList) return;\n\n  var newContainer = this.parent[this.listKey];\n  if (this.container === newContainer) return;\n\n  this.container = newContainer || null;\n}\n\nfunction _resyncRemoved() {\n  if (this.key == null || !this.container || this.container[this.key] !== this.node) {\n    this._markRemoved();\n  }\n}\n\nfunction popContext() {\n  this.contexts.pop();\n  this.setContext(this.contexts[this.contexts.length - 1]);\n}\n\nfunction pushContext(context) {\n  this.contexts.push(context);\n  this.setContext(context);\n}\n\nfunction setup(parentPath, container, listKey, key) {\n  this.inList = !!listKey;\n  this.listKey = listKey;\n  this.parentKey = listKey || key;\n  this.container = container;\n\n  this.parentPath = parentPath || this.parentPath;\n  this.setKey(key);\n}\n\nfunction setKey(key) {\n  this.key = key;\n  this.node = this.container[this.key];\n  this.type = this.node && this.node.type;\n}\n\nfunction requeue() {\n  var pathToQueue = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this;\n\n  if (pathToQueue.removed) return;\n\n  var contexts = this.contexts;\n\n  for (var _iterator2 = contexts, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : (0, _getIterator3.default)(_iterator2);;) {\n    var _ref2;\n\n    if (_isArray2) {\n      if (_i2 >= _iterator2.length) break;\n      _ref2 = _iterator2[_i2++];\n    } else {\n      _i2 = _iterator2.next();\n      if (_i2.done) break;\n      _ref2 = _i2.value;\n    }\n\n    var context = _ref2;\n\n    context.maybeQueue(pathToQueue);\n  }\n}\n\nfunction _getQueueContexts() {\n  var path = this;\n  var contexts = this.contexts;\n  while (!contexts.length) {\n    path = path.parentPath;\n    contexts = path.contexts;\n  }\n  return contexts;\n}"]}