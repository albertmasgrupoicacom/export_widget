{"version":3,"sources":["context.js"],"names":["exports","__esModule","_getIterator2","require","_getIterator3","_interopRequireDefault","_classCallCheck2","_classCallCheck3","_path2","_path3","_babelTypes","t","_interopRequireWildcard","obj","newObj","key","Object","prototype","hasOwnProperty","call","default","testing","TraversalContext","scope","opts","state","parentPath","queue","shouldVisit","node","enter","exit","type","keys","VISITOR_KEYS","length","_iterator","_isArray","Array","isArray","_i","_ref","next","done","value","create","listKey","get","parent","container","maybeQueue","path","notPriority","trap","Error","push","priorityQueue","visitMultiple","visitQueue","visitSingle","visited","stop","_iterator2","_isArray2","_i2","_ref2","resync","contexts","pushContext","indexOf","visit","_iterator3","_isArray3","_i3","_ref3","_path","popContext","nodes","module"],"mappings":"AAAA;;;;;;AAEAA,YAAQC,UAAR,GAAqB,IAArB;;AAEA,QAAIC,gBAAgBC,QAAQ,4CAAR,CAApB;;AAEA,QAAIC,gBAAgBC,uBAAuBH,aAAvB,CAApB;;AAEA,QAAII,mBAAmBH,QAAQ,8CAAR,CAAvB;;AAEA,QAAII,mBAAmBF,uBAAuBC,gBAAvB,CAAvB;;AAEA,QAAIE,SAASL,QAAQ,QAAR,CAAb;;AAEA,QAAIM,SAASJ,uBAAuBG,MAAvB,CAAb;;AAEA,QAAIE,cAAcP,QAAQ,qBAAR,CAAlB;;AAEA,QAAIQ,IAAIC,wBAAwBF,WAAxB,CAAR;;AAEA,aAASE,uBAAT,CAAiCC,GAAjC,EAAsC;AAAE,UAAIA,OAAOA,IAAIZ,UAAf,EAA2B;AAAE,eAAOY,GAAP;AAAa,OAA1C,MAAgD;AAAE,YAAIC,SAAS,EAAb,CAAiB,IAAID,OAAO,IAAX,EAAiB;AAAE,eAAK,IAAIE,GAAT,IAAgBF,GAAhB,EAAqB;AAAE,gBAAIG,OAAOC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCN,GAArC,EAA0CE,GAA1C,CAAJ,EAAoDD,OAAOC,GAAP,IAAcF,IAAIE,GAAJ,CAAd;AAAyB;AAAE,SAACD,OAAOM,OAAP,GAAiBP,GAAjB,CAAsB,OAAOC,MAAP;AAAgB;AAAE;;AAE7Q,aAAST,sBAAT,CAAgCQ,GAAhC,EAAqC;AAAE,aAAOA,OAAOA,IAAIZ,UAAX,GAAwBY,GAAxB,GAA8B,EAAEO,SAASP,GAAX,EAArC;AAAwD;;AAE/F,QAAIQ,eAAJ;;AAEA,QAAIC,mBAAmB,YAAY;AACjC,eAASA,gBAAT,CAA0BC,KAA1B,EAAiCC,IAAjC,EAAuCC,KAAvC,EAA8CC,UAA9C,EAA0D;AACxD,SAAC,GAAGnB,iBAAiBa,OAArB,EAA8B,IAA9B,EAAoCE,gBAApC;AACA,aAAKK,KAAL,GAAa,IAAb;;AAEA,aAAKD,UAAL,GAAkBA,UAAlB;AACA,aAAKH,KAAL,GAAaA,KAAb;AACA,aAAKE,KAAL,GAAaA,KAAb;AACA,aAAKD,IAAL,GAAYA,IAAZ;AACD;;AAEDF,uBAAiBL,SAAjB,CAA2BW,WAA3B,GAAyC,SAASA,WAAT,CAAqBC,IAArB,EAA2B;AAClE,YAAIL,OAAO,KAAKA,IAAhB;AACA,YAAIA,KAAKM,KAAL,IAAcN,KAAKO,IAAvB,EAA6B,OAAO,IAAP;;AAE7B,YAAIP,KAAKK,KAAKG,IAAV,CAAJ,EAAqB,OAAO,IAAP;;AAErB,YAAIC,OAAOtB,EAAEuB,YAAF,CAAeL,KAAKG,IAApB,CAAX;AACA,YAAI,CAACC,IAAD,IAAS,CAACA,KAAKE,MAAnB,EAA2B,OAAO,KAAP;;AAE3B,aAAK,IAAIC,YAAYH,IAAhB,EAAsBI,WAAWC,MAAMC,OAAN,CAAcH,SAAd,CAAjC,EAA2DI,KAAK,CAAhE,EAAmEJ,YAAYC,WAAWD,SAAX,GAAuB,CAAC,GAAGhC,cAAcgB,OAAlB,EAA2BgB,SAA3B,CAA3G,IAAoJ;AAClJ,cAAIK,IAAJ;;AAEA,cAAIJ,QAAJ,EAAc;AACZ,gBAAIG,MAAMJ,UAAUD,MAApB,EAA4B;AAC5BM,mBAAOL,UAAUI,IAAV,CAAP;AACD,WAHD,MAGO;AACLA,iBAAKJ,UAAUM,IAAV,EAAL;AACA,gBAAIF,GAAGG,IAAP,EAAa;AACbF,mBAAOD,GAAGI,KAAV;AACD;;AAED,cAAI7B,MAAM0B,IAAV;;AAEA,cAAIZ,KAAKd,GAAL,CAAJ,EAAe,OAAO,IAAP;AAChB;;AAED,eAAO,KAAP;AACD,OA3BD;;AA6BAO,uBAAiBL,SAAjB,CAA2B4B,MAA3B,GAAoC,SAASA,MAAT,CAAgBhB,IAAhB,EAAsBhB,GAAtB,EAA2BE,GAA3B,EAAgC+B,OAAhC,EAAyC;AAC3E,eAAOrC,OAAOW,OAAP,CAAe2B,GAAf,CAAmB;AACxBrB,sBAAY,KAAKA,UADO;AAExBsB,kBAAQnB,IAFgB;AAGxBoB,qBAAWpC,GAHa;AAIxBE,eAAKA,GAJmB;AAKxB+B,mBAASA;AALe,SAAnB,CAAP;AAOD,OARD;;AAUAxB,uBAAiBL,SAAjB,CAA2BiC,UAA3B,GAAwC,SAASA,UAAT,CAAoBC,IAApB,EAA0BC,WAA1B,EAAuC;AAC7E,YAAI,KAAKC,IAAT,EAAe;AACb,gBAAM,IAAIC,KAAJ,CAAU,yBAAV,CAAN;AACD;;AAED,YAAI,KAAK3B,KAAT,EAAgB;AACd,cAAIyB,WAAJ,EAAiB;AACf,iBAAKzB,KAAL,CAAW4B,IAAX,CAAgBJ,IAAhB;AACD,WAFD,MAEO;AACL,iBAAKK,aAAL,CAAmBD,IAAnB,CAAwBJ,IAAxB;AACD;AACF;AACF,OAZD;;AAcA7B,uBAAiBL,SAAjB,CAA2BwC,aAA3B,GAA2C,SAASA,aAAT,CAAuBR,SAAvB,EAAkCD,MAAlC,EAA0CF,OAA1C,EAAmD;AAC5F,YAAIG,UAAUd,MAAV,KAAqB,CAAzB,EAA4B,OAAO,KAAP;;AAE5B,YAAIR,QAAQ,EAAZ;;AAEA,aAAK,IAAIZ,MAAM,CAAf,EAAkBA,MAAMkC,UAAUd,MAAlC,EAA0CpB,KAA1C,EAAiD;AAC/C,cAAIc,OAAOoB,UAAUlC,GAAV,CAAX;AACA,cAAIc,QAAQ,KAAKD,WAAL,CAAiBC,IAAjB,CAAZ,EAAoC;AAClCF,kBAAM4B,IAAN,CAAW,KAAKV,MAAL,CAAYG,MAAZ,EAAoBC,SAApB,EAA+BlC,GAA/B,EAAoC+B,OAApC,CAAX;AACD;AACF;;AAED,eAAO,KAAKY,UAAL,CAAgB/B,KAAhB,CAAP;AACD,OAbD;;AAeAL,uBAAiBL,SAAjB,CAA2B0C,WAA3B,GAAyC,SAASA,WAAT,CAAqB9B,IAArB,EAA2Bd,GAA3B,EAAgC;AACvE,YAAI,KAAKa,WAAL,CAAiBC,KAAKd,GAAL,CAAjB,CAAJ,EAAiC;AAC/B,iBAAO,KAAK2C,UAAL,CAAgB,CAAC,KAAKb,MAAL,CAAYhB,IAAZ,EAAkBA,IAAlB,EAAwBd,GAAxB,CAAD,CAAhB,CAAP;AACD,SAFD,MAEO;AACL,iBAAO,KAAP;AACD;AACF,OAND;;AAQAO,uBAAiBL,SAAjB,CAA2ByC,UAA3B,GAAwC,SAASA,UAAT,CAAoB/B,KAApB,EAA2B;AACjE,aAAKA,KAAL,GAAaA,KAAb;AACA,aAAK6B,aAAL,GAAqB,EAArB;;AAEA,YAAII,UAAU,EAAd;AACA,YAAIC,OAAO,KAAX;;AAEA,aAAK,IAAIC,aAAanC,KAAjB,EAAwBoC,YAAYzB,MAAMC,OAAN,CAAcuB,UAAd,CAApC,EAA+DE,MAAM,CAArE,EAAwEF,aAAaC,YAAYD,UAAZ,GAAyB,CAAC,GAAG1D,cAAcgB,OAAlB,EAA2B0C,UAA3B,CAAnH,IAA6J;AAC3J,cAAIG,KAAJ;;AAEA,cAAIF,SAAJ,EAAe;AACb,gBAAIC,OAAOF,WAAW3B,MAAtB,EAA8B;AAC9B8B,oBAAQH,WAAWE,KAAX,CAAR;AACD,WAHD,MAGO;AACLA,kBAAMF,WAAWpB,IAAX,EAAN;AACA,gBAAIsB,IAAIrB,IAAR,EAAc;AACdsB,oBAAQD,IAAIpB,KAAZ;AACD;;AAED,cAAIO,OAAOc,KAAX;;AAEAd,eAAKe,MAAL;;AAEA,cAAIf,KAAKgB,QAAL,CAAchC,MAAd,KAAyB,CAAzB,IAA8BgB,KAAKgB,QAAL,CAAchB,KAAKgB,QAAL,CAAchC,MAAd,GAAuB,CAArC,MAA4C,IAA9E,EAAoF;AAClFgB,iBAAKiB,WAAL,CAAiB,IAAjB;AACD;;AAED,cAAIjB,KAAKpC,GAAL,KAAa,IAAjB,EAAuB;;AAMvB,cAAI6C,QAAQS,OAAR,CAAgBlB,KAAKtB,IAArB,KAA8B,CAAlC,EAAqC;AACrC+B,kBAAQL,IAAR,CAAaJ,KAAKtB,IAAlB;;AAEA,cAAIsB,KAAKmB,KAAL,EAAJ,EAAkB;AAChBT,mBAAO,IAAP;AACA;AACD;;AAED,cAAI,KAAKL,aAAL,CAAmBrB,MAAvB,EAA+B;AAC7B0B,mBAAO,KAAKH,UAAL,CAAgB,KAAKF,aAArB,CAAP;AACA,iBAAKA,aAAL,GAAqB,EAArB;AACA,iBAAK7B,KAAL,GAAaA,KAAb;AACA,gBAAIkC,IAAJ,EAAU;AACX;AACF;;AAED,aAAK,IAAIU,aAAa5C,KAAjB,EAAwB6C,YAAYlC,MAAMC,OAAN,CAAcgC,UAAd,CAApC,EAA+DE,MAAM,CAArE,EAAwEF,aAAaC,YAAYD,UAAZ,GAAyB,CAAC,GAAGnE,cAAcgB,OAAlB,EAA2BmD,UAA3B,CAAnH,IAA6J;AAC3J,cAAIG,KAAJ;;AAEA,cAAIF,SAAJ,EAAe;AACb,gBAAIC,OAAOF,WAAWpC,MAAtB,EAA8B;AAC9BuC,oBAAQH,WAAWE,KAAX,CAAR;AACD,WAHD,MAGO;AACLA,kBAAMF,WAAW7B,IAAX,EAAN;AACA,gBAAI+B,IAAI9B,IAAR,EAAc;AACd+B,oBAAQD,IAAI7B,KAAZ;AACD;;AAED,cAAI+B,QAAQD,KAAZ;;AAEAC,gBAAMC,UAAN;AACD;;AAED,aAAKjD,KAAL,GAAa,IAAb;;AAEA,eAAOkC,IAAP;AACD,OArED;;AAuEAvC,uBAAiBL,SAAjB,CAA2BqD,KAA3B,GAAmC,SAASA,KAAT,CAAezC,IAAf,EAAqBd,GAArB,EAA0B;AAC3D,YAAI8D,QAAQhD,KAAKd,GAAL,CAAZ;AACA,YAAI,CAAC8D,KAAL,EAAY,OAAO,KAAP;;AAEZ,YAAIvC,MAAMC,OAAN,CAAcsC,KAAd,CAAJ,EAA0B;AACxB,iBAAO,KAAKpB,aAAL,CAAmBoB,KAAnB,EAA0BhD,IAA1B,EAAgCd,GAAhC,CAAP;AACD,SAFD,MAEO;AACL,iBAAO,KAAK4C,WAAL,CAAiB9B,IAAjB,EAAuBd,GAAvB,CAAP;AACD;AACF,OATD;;AAWA,aAAOO,gBAAP;AACD,KA1KsB,EAAvB;;AA4KAtB,YAAQoB,OAAR,GAAkBE,gBAAlB;AACAwD,WAAO9E,OAAP,GAAiBA,QAAQ,SAAR,CAAjB","file":"context.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _path2 = require(\"./path\");\n\nvar _path3 = _interopRequireDefault(_path2);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar testing = process.env.NODE_ENV === \"test\";\n\nvar TraversalContext = function () {\n  function TraversalContext(scope, opts, state, parentPath) {\n    (0, _classCallCheck3.default)(this, TraversalContext);\n    this.queue = null;\n\n    this.parentPath = parentPath;\n    this.scope = scope;\n    this.state = state;\n    this.opts = opts;\n  }\n\n  TraversalContext.prototype.shouldVisit = function shouldVisit(node) {\n    var opts = this.opts;\n    if (opts.enter || opts.exit) return true;\n\n    if (opts[node.type]) return true;\n\n    var keys = t.VISITOR_KEYS[node.type];\n    if (!keys || !keys.length) return false;\n\n    for (var _iterator = keys, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : (0, _getIterator3.default)(_iterator);;) {\n      var _ref;\n\n      if (_isArray) {\n        if (_i >= _iterator.length) break;\n        _ref = _iterator[_i++];\n      } else {\n        _i = _iterator.next();\n        if (_i.done) break;\n        _ref = _i.value;\n      }\n\n      var key = _ref;\n\n      if (node[key]) return true;\n    }\n\n    return false;\n  };\n\n  TraversalContext.prototype.create = function create(node, obj, key, listKey) {\n    return _path3.default.get({\n      parentPath: this.parentPath,\n      parent: node,\n      container: obj,\n      key: key,\n      listKey: listKey\n    });\n  };\n\n  TraversalContext.prototype.maybeQueue = function maybeQueue(path, notPriority) {\n    if (this.trap) {\n      throw new Error(\"Infinite cycle detected\");\n    }\n\n    if (this.queue) {\n      if (notPriority) {\n        this.queue.push(path);\n      } else {\n        this.priorityQueue.push(path);\n      }\n    }\n  };\n\n  TraversalContext.prototype.visitMultiple = function visitMultiple(container, parent, listKey) {\n    if (container.length === 0) return false;\n\n    var queue = [];\n\n    for (var key = 0; key < container.length; key++) {\n      var node = container[key];\n      if (node && this.shouldVisit(node)) {\n        queue.push(this.create(parent, container, key, listKey));\n      }\n    }\n\n    return this.visitQueue(queue);\n  };\n\n  TraversalContext.prototype.visitSingle = function visitSingle(node, key) {\n    if (this.shouldVisit(node[key])) {\n      return this.visitQueue([this.create(node, node, key)]);\n    } else {\n      return false;\n    }\n  };\n\n  TraversalContext.prototype.visitQueue = function visitQueue(queue) {\n    this.queue = queue;\n    this.priorityQueue = [];\n\n    var visited = [];\n    var stop = false;\n\n    for (var _iterator2 = queue, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : (0, _getIterator3.default)(_iterator2);;) {\n      var _ref2;\n\n      if (_isArray2) {\n        if (_i2 >= _iterator2.length) break;\n        _ref2 = _iterator2[_i2++];\n      } else {\n        _i2 = _iterator2.next();\n        if (_i2.done) break;\n        _ref2 = _i2.value;\n      }\n\n      var path = _ref2;\n\n      path.resync();\n\n      if (path.contexts.length === 0 || path.contexts[path.contexts.length - 1] !== this) {\n        path.pushContext(this);\n      }\n\n      if (path.key === null) continue;\n\n      if (testing && queue.length >= 10000) {\n        this.trap = true;\n      }\n\n      if (visited.indexOf(path.node) >= 0) continue;\n      visited.push(path.node);\n\n      if (path.visit()) {\n        stop = true;\n        break;\n      }\n\n      if (this.priorityQueue.length) {\n        stop = this.visitQueue(this.priorityQueue);\n        this.priorityQueue = [];\n        this.queue = queue;\n        if (stop) break;\n      }\n    }\n\n    for (var _iterator3 = queue, _isArray3 = Array.isArray(_iterator3), _i3 = 0, _iterator3 = _isArray3 ? _iterator3 : (0, _getIterator3.default)(_iterator3);;) {\n      var _ref3;\n\n      if (_isArray3) {\n        if (_i3 >= _iterator3.length) break;\n        _ref3 = _iterator3[_i3++];\n      } else {\n        _i3 = _iterator3.next();\n        if (_i3.done) break;\n        _ref3 = _i3.value;\n      }\n\n      var _path = _ref3;\n\n      _path.popContext();\n    }\n\n    this.queue = null;\n\n    return stop;\n  };\n\n  TraversalContext.prototype.visit = function visit(node, key) {\n    var nodes = node[key];\n    if (!nodes) return false;\n\n    if (Array.isArray(nodes)) {\n      return this.visitMultiple(nodes, node, key);\n    } else {\n      return this.visitSingle(node, key);\n    }\n  };\n\n  return TraversalContext;\n}();\n\nexports.default = TraversalContext;\nmodule.exports = exports[\"default\"];"]}