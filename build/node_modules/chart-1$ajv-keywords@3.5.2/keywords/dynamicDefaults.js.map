{"version":3,"sources":["dynamicDefaults.js"],"names":["sequences","DEFAULTS","timestamp","Date","now","datetime","toISOString","date","slice","time","random","Math","randomint","args","limit","max","floor","seq","name","module","exports","defFunc","ajv","definition","compile","schema","parentSchema","it","funcs","key","d","func","getDefault","length","opts","useDefaults","compositeRule","assignDefaults","data","prop","undefined","noop","metaSchema","type","additionalProperties","required","properties","addKeyword","def","Error"],"mappings":"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","file":"dynamicDefaults.js","sourcesContent":["'use strict';\n\nvar sequences = {};\n\nvar DEFAULTS = {\n  timestamp: function() { return Date.now(); },\n  datetime: function() { return (new Date).toISOString(); },\n  date: function() { return (new Date).toISOString().slice(0, 10); },\n  time: function() { return (new Date).toISOString().slice(11); },\n  random: function() { return Math.random(); },\n  randomint: function (args) {\n    var limit = args && args.max || 2;\n    return function() { return Math.floor(Math.random() * limit); };\n  },\n  seq: function (args) {\n    var name = args && args.name || '';\n    sequences[name] = sequences[name] || 0;\n    return function() { return sequences[name]++; };\n  }\n};\n\nmodule.exports = function defFunc(ajv) {\n  defFunc.definition = {\n    compile: function (schema, parentSchema, it) {\n      var funcs = {};\n\n      for (var key in schema) {\n        var d = schema[key];\n        var func = getDefault(typeof d == 'string' ? d : d.func);\n        funcs[key] = func.length ? func(d.args) : func;\n      }\n\n      return it.opts.useDefaults && !it.compositeRule\n              ? assignDefaults\n              : noop;\n\n      function assignDefaults(data) {\n        for (var prop in schema){\n          if (data[prop] === undefined\n            || (it.opts.useDefaults == 'empty'\n            && (data[prop] === null || data[prop] === '')))\n            data[prop] = funcs[prop]();\n        }\n        return true;\n      }\n\n      function noop() { return true; }\n    },\n    DEFAULTS: DEFAULTS,\n    metaSchema: {\n      type: 'object',\n      additionalProperties: {\n        type: ['string', 'object'],\n        additionalProperties: false,\n        required: ['func', 'args'],\n        properties: {\n          func: { type: 'string' },\n          args: { type: 'object' }\n        }\n      }\n    }\n  };\n\n  ajv.addKeyword('dynamicDefaults', defFunc.definition);\n  return ajv;\n\n  function getDefault(d) {\n    var def = DEFAULTS[d];\n    if (def) return def;\n    throw new Error('invalid \"dynamicDefaults\" keyword property value: ' + d);\n  }\n};\n"]}