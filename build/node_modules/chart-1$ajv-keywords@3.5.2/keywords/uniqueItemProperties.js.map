{"version":3,"sources":["uniqueItemProperties.js"],"names":["SCALAR_TYPES","module","exports","defFunc","ajv","definition","type","compile","keys","parentSchema","it","equal","util","scalar","getScalarKeys","data","length","k","i","key","hash","prop","j","metaSchema","items","addKeyword","schema","map","properties","propType","Array","isArray","indexOf"],"mappings":"AAAA;;;;;;AAEA,QAAIA,eAAe,CAAC,QAAD,EAAW,SAAX,EAAsB,QAAtB,EAAgC,SAAhC,EAA2C,MAA3C,CAAnB;;AAEAC,WAAOC,OAAP,GAAiB,SAASC,OAAT,CAAiBC,GAAjB,EAAsB;AACrCD,cAAQE,UAAR,GAAqB;AACnBC,cAAM,OADa;AAEnBC,iBAAS,UAASC,IAAT,EAAeC,YAAf,EAA6BC,EAA7B,EAAiC;AACxC,cAAIC,QAAQD,GAAGE,IAAH,CAAQD,KAApB;AACA,cAAIE,SAASC,cAAcN,IAAd,EAAoBC,YAApB,CAAb;;AAEA,iBAAO,UAASM,IAAT,EAAe;AACpB,gBAAIA,KAAKC,MAAL,GAAc,CAAlB,EAAqB;AACnB,mBAAK,IAAIC,IAAE,CAAX,EAAcA,IAAIT,KAAKQ,MAAvB,EAA+BC,GAA/B,EAAoC;AAClC,oBAAIC,CAAJ;AAAA,oBAAOC,MAAMX,KAAKS,CAAL,CAAb;AACA,oBAAIJ,OAAOI,CAAP,CAAJ,EAAe;AACb,sBAAIG,OAAO,EAAX;AACA,uBAAKF,IAAIH,KAAKC,MAAd,EAAsBE,GAAtB,GAA4B;AAC1B,wBAAI,CAACH,KAAKG,CAAL,CAAD,IAAY,OAAOH,KAAKG,CAAL,CAAP,IAAkB,QAAlC,EAA4C;AAC5C,wBAAIG,OAAON,KAAKG,CAAL,EAAQC,GAAR,CAAX;AACA,wBAAIE,QAAQ,OAAOA,IAAP,IAAe,QAA3B,EAAqC;AACrC,wBAAI,OAAOA,IAAP,IAAe,QAAnB,EAA6BA,OAAO,MAAMA,IAAb;AAC7B,wBAAID,KAAKC,IAAL,CAAJ,EAAgB,OAAO,KAAP;AAChBD,yBAAKC,IAAL,IAAa,IAAb;AACD;AACF,iBAVD,MAUO;AACL,uBAAKH,IAAIH,KAAKC,MAAd,EAAsBE,GAAtB,GAA4B;AAC1B,wBAAI,CAACH,KAAKG,CAAL,CAAD,IAAY,OAAOH,KAAKG,CAAL,CAAP,IAAkB,QAAlC,EAA4C;AAC5C,yBAAK,IAAII,IAAIJ,CAAb,EAAgBI,GAAhB,GAAsB;AACpB,0BAAIP,KAAKO,CAAL,KAAW,OAAOP,KAAKO,CAAL,CAAP,IAAkB,QAA7B,IAAyCX,MAAMI,KAAKG,CAAL,EAAQC,GAAR,CAAN,EAAoBJ,KAAKO,CAAL,EAAQH,GAAR,CAApB,CAA7C,EACE,OAAO,KAAP;AACH;AACF;AACF;AACF;AACF;AACD,mBAAO,IAAP;AACD,WA1BD;AA2BD,SAjCkB;AAkCnBI,oBAAY;AACVjB,gBAAM,OADI;AAEVkB,iBAAO,EAAClB,MAAM,QAAP;AAFG;AAlCO,OAArB;;AAwCAF,UAAIqB,UAAJ,CAAe,sBAAf,EAAuCtB,QAAQE,UAA/C;AACA,aAAOD,GAAP;AACD,KA3CD;;AA8CA,aAASU,aAAT,CAAuBN,IAAvB,EAA6BkB,MAA7B,EAAqC;AACnC,aAAOlB,KAAKmB,GAAL,CAAS,UAASR,GAAT,EAAc;AAC5B,YAAIS,aAAaF,OAAOF,KAAP,IAAgBE,OAAOF,KAAP,CAAaI,UAA9C;AACA,YAAIC,WAAWD,cAAcA,WAAWT,GAAX,CAAd,IAAiCS,WAAWT,GAAX,EAAgBb,IAAhE;AACA,eAAOwB,MAAMC,OAAN,CAAcF,QAAd,IACGA,SAASG,OAAT,CAAiB,QAAjB,IAA6B,CAA7B,IAAkCH,SAASG,OAAT,CAAiB,OAAjB,IAA4B,CADjE,GAEGhC,aAAagC,OAAb,CAAqBH,QAArB,KAAkC,CAF5C;AAGD,OANM,CAAP;AAOD","file":"uniqueItemProperties.js","sourcesContent":["'use strict';\n\nvar SCALAR_TYPES = ['number', 'integer', 'string', 'boolean', 'null'];\n\nmodule.exports = function defFunc(ajv) {\n  defFunc.definition = {\n    type: 'array',\n    compile: function(keys, parentSchema, it) {\n      var equal = it.util.equal;\n      var scalar = getScalarKeys(keys, parentSchema);\n\n      return function(data) {\n        if (data.length > 1) {\n          for (var k=0; k < keys.length; k++) {\n            var i, key = keys[k];\n            if (scalar[k]) {\n              var hash = {};\n              for (i = data.length; i--;) {\n                if (!data[i] || typeof data[i] != 'object') continue;\n                var prop = data[i][key];\n                if (prop && typeof prop == 'object') continue;\n                if (typeof prop == 'string') prop = '\"' + prop;\n                if (hash[prop]) return false;\n                hash[prop] = true;\n              }\n            } else {\n              for (i = data.length; i--;) {\n                if (!data[i] || typeof data[i] != 'object') continue;\n                for (var j = i; j--;) {\n                  if (data[j] && typeof data[j] == 'object' && equal(data[i][key], data[j][key]))\n                    return false;\n                }\n              }\n            }\n          }\n        }\n        return true;\n      };\n    },\n    metaSchema: {\n      type: 'array',\n      items: {type: 'string'}\n    }\n  };\n\n  ajv.addKeyword('uniqueItemProperties', defFunc.definition);\n  return ajv;\n};\n\n\nfunction getScalarKeys(keys, schema) {\n  return keys.map(function(key) {\n    var properties = schema.items && schema.items.properties;\n    var propType = properties && properties[key] && properties[key].type;\n    return Array.isArray(propType)\n            ? propType.indexOf('object') < 0 && propType.indexOf('array') < 0\n            : SCALAR_TYPES.indexOf(propType) >= 0;\n  });\n}\n"]}