{"version":3,"sources":["index.js"],"names":["exports","__esModule","_symbol","require","_symbol2","_interopRequireDefault","default","code","opts","stack","Error","error","split","slice","join","_assign2","allowReturnOutsideFunction","allowSuperOutsideMethod","preserveComments","_getAst","getAst","ast","babylon","parse","_babelTraverse2","removeProperties","cheap","node","FROM_TEMPLATE","err","_len","arguments","length","args","Array","_key","useTemplate","_cloneDeep","_cloneDeep2","_assign","_has","_has2","_babelTraverse","_babylon","_interopRequireWildcard","_babelTypes","t","obj","newObj","key","Object","prototype","hasOwnProperty","call","TEMPLATE_SKIP","nodes","_ast","program","templateVisitor","body","noScope","enter","path","skip","isExpressionStatement","expression","replacement","isIdentifier","name","i","remove","replaceInline","exit","_ref","loc","clearNode","module"],"mappings":"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","file":"index.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _symbol = require(\"babel-runtime/core-js/symbol\");\n\nvar _symbol2 = _interopRequireDefault(_symbol);\n\nexports.default = function (code, opts) {\n  var stack = void 0;\n  try {\n    throw new Error();\n  } catch (error) {\n    if (error.stack) {\n      stack = error.stack.split(\"\\n\").slice(1).join(\"\\n\");\n    }\n  }\n\n  opts = (0, _assign2.default)({\n    allowReturnOutsideFunction: true,\n    allowSuperOutsideMethod: true,\n    preserveComments: false\n  }, opts);\n\n  var _getAst = function getAst() {\n    var ast = void 0;\n\n    try {\n      ast = babylon.parse(code, opts);\n\n      ast = _babelTraverse2.default.removeProperties(ast, { preserveComments: opts.preserveComments });\n\n      _babelTraverse2.default.cheap(ast, function (node) {\n        node[FROM_TEMPLATE] = true;\n      });\n    } catch (err) {\n      err.stack = err.stack + \"from\\n\" + stack;\n      throw err;\n    }\n\n    _getAst = function getAst() {\n      return ast;\n    };\n\n    return ast;\n  };\n\n  return function () {\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return useTemplate(_getAst(), args);\n  };\n};\n\nvar _cloneDeep = require(\"lodash/cloneDeep\");\n\nvar _cloneDeep2 = _interopRequireDefault(_cloneDeep);\n\nvar _assign = require(\"lodash/assign\");\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nvar _has = require(\"lodash/has\");\n\nvar _has2 = _interopRequireDefault(_has);\n\nvar _babelTraverse = require(\"babel-traverse\");\n\nvar _babelTraverse2 = _interopRequireDefault(_babelTraverse);\n\nvar _babylon = require(\"babylon\");\n\nvar babylon = _interopRequireWildcard(_babylon);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar FROM_TEMPLATE = \"_fromTemplate\";\nvar TEMPLATE_SKIP = (0, _symbol2.default)();\n\nfunction useTemplate(ast, nodes) {\n  ast = (0, _cloneDeep2.default)(ast);\n  var _ast = ast,\n      program = _ast.program;\n\n\n  if (nodes.length) {\n    (0, _babelTraverse2.default)(ast, templateVisitor, null, nodes);\n  }\n\n  if (program.body.length > 1) {\n    return program.body;\n  } else {\n    return program.body[0];\n  }\n}\n\nvar templateVisitor = {\n  noScope: true,\n\n  enter: function enter(path, args) {\n    var node = path.node;\n\n    if (node[TEMPLATE_SKIP]) return path.skip();\n\n    if (t.isExpressionStatement(node)) {\n      node = node.expression;\n    }\n\n    var replacement = void 0;\n\n    if (t.isIdentifier(node) && node[FROM_TEMPLATE]) {\n      if ((0, _has2.default)(args[0], node.name)) {\n        replacement = args[0][node.name];\n      } else if (node.name[0] === \"$\") {\n        var i = +node.name.slice(1);\n        if (args[i]) replacement = args[i];\n      }\n    }\n\n    if (replacement === null) {\n      path.remove();\n    }\n\n    if (replacement) {\n      replacement[TEMPLATE_SKIP] = true;\n      path.replaceInline(replacement);\n    }\n  },\n  exit: function exit(_ref) {\n    var node = _ref.node;\n\n    if (!node.loc) _babelTraverse2.default.clearNode(node);\n  }\n};\nmodule.exports = exports[\"default\"];"]}