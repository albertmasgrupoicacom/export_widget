{"version":3,"sources":["index.js"],"names":["exports","__esModule","_getIterator2","require","_getIterator3","_interopRequireDefault","default","_ref","t","types","getSpreadLiteral","spread","scope","state","opts","loose","isIdentifier","argument","name","toArray","hasSpread","nodes","i","length","isSpreadElement","build","props","_props","push","arrayExpression","_iterator","_isArray","Array","isArray","_i","_ref2","next","done","value","prop","visitor","ArrayExpression","path","node","elements","first","shift","isArrayExpression","unshift","replaceWith","callExpression","memberExpression","identifier","CallExpression","args","arguments","calleePath","get","isSuper","contextLiteral","callee","isMemberExpression","temp","maybeGenerateMemoised","object","assignmentExpression","appendToMemberExpression","thisExpression","NewExpression","context","nullLiteral","newExpression","obj","module"],"mappings":"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","file":"index.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nexports.default = function (_ref) {\n  var t = _ref.types;\n\n  function getSpreadLiteral(spread, scope, state) {\n    if (state.opts.loose && !t.isIdentifier(spread.argument, { name: \"arguments\" })) {\n      return spread.argument;\n    } else {\n      return scope.toArray(spread.argument, true);\n    }\n  }\n\n  function hasSpread(nodes) {\n    for (var i = 0; i < nodes.length; i++) {\n      if (t.isSpreadElement(nodes[i])) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  function build(props, scope, state) {\n    var nodes = [];\n\n    var _props = [];\n\n    function push() {\n      if (!_props.length) return;\n      nodes.push(t.arrayExpression(_props));\n      _props = [];\n    }\n\n    for (var _iterator = props, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : (0, _getIterator3.default)(_iterator);;) {\n      var _ref2;\n\n      if (_isArray) {\n        if (_i >= _iterator.length) break;\n        _ref2 = _iterator[_i++];\n      } else {\n        _i = _iterator.next();\n        if (_i.done) break;\n        _ref2 = _i.value;\n      }\n\n      var prop = _ref2;\n\n      if (t.isSpreadElement(prop)) {\n        push();\n        nodes.push(getSpreadLiteral(prop, scope, state));\n      } else {\n        _props.push(prop);\n      }\n    }\n\n    push();\n\n    return nodes;\n  }\n\n  return {\n    visitor: {\n      ArrayExpression: function ArrayExpression(path, state) {\n        var node = path.node,\n            scope = path.scope;\n\n        var elements = node.elements;\n        if (!hasSpread(elements)) return;\n\n        var nodes = build(elements, scope, state);\n        var first = nodes.shift();\n\n        if (!t.isArrayExpression(first)) {\n          nodes.unshift(first);\n          first = t.arrayExpression([]);\n        }\n\n        path.replaceWith(t.callExpression(t.memberExpression(first, t.identifier(\"concat\")), nodes));\n      },\n      CallExpression: function CallExpression(path, state) {\n        var node = path.node,\n            scope = path.scope;\n\n\n        var args = node.arguments;\n        if (!hasSpread(args)) return;\n\n        var calleePath = path.get(\"callee\");\n        if (calleePath.isSuper()) return;\n\n        var contextLiteral = t.identifier(\"undefined\");\n\n        node.arguments = [];\n\n        var nodes = void 0;\n        if (args.length === 1 && args[0].argument.name === \"arguments\") {\n          nodes = [args[0].argument];\n        } else {\n          nodes = build(args, scope, state);\n        }\n\n        var first = nodes.shift();\n        if (nodes.length) {\n          node.arguments.push(t.callExpression(t.memberExpression(first, t.identifier(\"concat\")), nodes));\n        } else {\n          node.arguments.push(first);\n        }\n\n        var callee = node.callee;\n\n        if (calleePath.isMemberExpression()) {\n          var temp = scope.maybeGenerateMemoised(callee.object);\n          if (temp) {\n            callee.object = t.assignmentExpression(\"=\", temp, callee.object);\n            contextLiteral = temp;\n          } else {\n            contextLiteral = callee.object;\n          }\n          t.appendToMemberExpression(callee, t.identifier(\"apply\"));\n        } else {\n          node.callee = t.memberExpression(node.callee, t.identifier(\"apply\"));\n        }\n\n        if (t.isSuper(contextLiteral)) {\n          contextLiteral = t.thisExpression();\n        }\n\n        node.arguments.unshift(contextLiteral);\n      },\n      NewExpression: function NewExpression(path, state) {\n        var node = path.node,\n            scope = path.scope;\n\n        var args = node.arguments;\n        if (!hasSpread(args)) return;\n\n        var nodes = build(args, scope, state);\n\n        var context = t.arrayExpression([t.nullLiteral()]);\n\n        args = t.callExpression(t.memberExpression(context, t.identifier(\"concat\")), nodes);\n\n        path.replaceWith(t.newExpression(t.callExpression(t.memberExpression(t.memberExpression(t.memberExpression(t.identifier(\"Function\"), t.identifier(\"prototype\")), t.identifier(\"bind\")), t.identifier(\"apply\")), [node.callee, args]), []));\n      }\n    }\n  };\n};\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nmodule.exports = exports[\"default\"];"]}