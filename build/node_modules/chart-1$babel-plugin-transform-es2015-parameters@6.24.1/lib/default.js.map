{"version":3,"sources":["default.js"],"names":["exports","__esModule","visitor","undefined","_getIterator2","require","_getIterator3","_interopRequireDefault","_babelHelperGetFunctionArity","_babelHelperGetFunctionArity2","_babelHelperCallDelegate","_babelHelperCallDelegate2","_babelTemplate","_babelTemplate2","_babelTypes","t","_interopRequireWildcard","obj","newObj","key","Object","prototype","hasOwnProperty","call","default","buildDefaultParam","buildCutOff","hasDefaults","node","_iterator","params","_isArray","Array","isArray","_i","_ref","length","next","done","value","param","isIdentifier","isSafeBinding","scope","hasOwnBinding","name","_scope$getOwnBinding","getOwnBinding","kind","iifeVisitor","ReferencedIdentifier","path","state","iife","stop","Scope","skip","Function","ensureBlock","body","argsIdentifier","identifier","_shadowedFunctionLiteral","pushDefNode","left","right","i","defNode","VARIABLE_NAME","DEFAULT_VALUE","ARGUMENT_KEY","numericLiteral","ARGUMENTS","_blockHoist","push","lastNonDefaultParam","get","isAssignmentPattern","traverse","isPattern","placeholder","generateUidIdentifier","_isDefaultPlaceholder","_i2","_param","declar","slice","set","blockStatement","unshiftContainer"],"mappings":"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","file":"default.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\nexports.visitor = undefined;\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _babelHelperGetFunctionArity = require(\"babel-helper-get-function-arity\");\n\nvar _babelHelperGetFunctionArity2 = _interopRequireDefault(_babelHelperGetFunctionArity);\n\nvar _babelHelperCallDelegate = require(\"babel-helper-call-delegate\");\n\nvar _babelHelperCallDelegate2 = _interopRequireDefault(_babelHelperCallDelegate);\n\nvar _babelTemplate = require(\"babel-template\");\n\nvar _babelTemplate2 = _interopRequireDefault(_babelTemplate);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar buildDefaultParam = (0, _babelTemplate2.default)(\"\\n  let VARIABLE_NAME =\\n    ARGUMENTS.length > ARGUMENT_KEY && ARGUMENTS[ARGUMENT_KEY] !== undefined ?\\n      ARGUMENTS[ARGUMENT_KEY]\\n    :\\n      DEFAULT_VALUE;\\n\");\n\nvar buildCutOff = (0, _babelTemplate2.default)(\"\\n  let $0 = $1[$2];\\n\");\n\nfunction hasDefaults(node) {\n  for (var _iterator = node.params, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : (0, _getIterator3.default)(_iterator);;) {\n    var _ref;\n\n    if (_isArray) {\n      if (_i >= _iterator.length) break;\n      _ref = _iterator[_i++];\n    } else {\n      _i = _iterator.next();\n      if (_i.done) break;\n      _ref = _i.value;\n    }\n\n    var param = _ref;\n\n    if (!t.isIdentifier(param)) return true;\n  }\n  return false;\n}\n\nfunction isSafeBinding(scope, node) {\n  if (!scope.hasOwnBinding(node.name)) return true;\n\n  var _scope$getOwnBinding = scope.getOwnBinding(node.name),\n      kind = _scope$getOwnBinding.kind;\n\n  return kind === \"param\" || kind === \"local\";\n}\n\nvar iifeVisitor = {\n  ReferencedIdentifier: function ReferencedIdentifier(path, state) {\n    var scope = path.scope,\n        node = path.node;\n\n    if (node.name === \"eval\" || !isSafeBinding(scope, node)) {\n      state.iife = true;\n      path.stop();\n    }\n  },\n  Scope: function Scope(path) {\n    path.skip();\n  }\n};\n\nvar visitor = exports.visitor = {\n  Function: function Function(path) {\n    var node = path.node,\n        scope = path.scope;\n\n    if (!hasDefaults(node)) return;\n\n    path.ensureBlock();\n\n    var state = {\n      iife: false,\n      scope: scope\n    };\n\n    var body = [];\n\n    var argsIdentifier = t.identifier(\"arguments\");\n    argsIdentifier._shadowedFunctionLiteral = path;\n\n    function pushDefNode(left, right, i) {\n      var defNode = buildDefaultParam({\n        VARIABLE_NAME: left,\n        DEFAULT_VALUE: right,\n        ARGUMENT_KEY: t.numericLiteral(i),\n        ARGUMENTS: argsIdentifier\n      });\n      defNode._blockHoist = node.params.length - i;\n      body.push(defNode);\n    }\n\n    var lastNonDefaultParam = (0, _babelHelperGetFunctionArity2.default)(node);\n\n    var params = path.get(\"params\");\n    for (var i = 0; i < params.length; i++) {\n      var param = params[i];\n\n      if (!param.isAssignmentPattern()) {\n        if (!state.iife && !param.isIdentifier()) {\n          param.traverse(iifeVisitor, state);\n        }\n\n        continue;\n      }\n\n      var left = param.get(\"left\");\n      var right = param.get(\"right\");\n\n      if (i >= lastNonDefaultParam || left.isPattern()) {\n        var placeholder = scope.generateUidIdentifier(\"x\");\n        placeholder._isDefaultPlaceholder = true;\n        node.params[i] = placeholder;\n      } else {\n        node.params[i] = left.node;\n      }\n\n      if (!state.iife) {\n        if (right.isIdentifier() && !isSafeBinding(scope, right.node)) {\n          state.iife = true;\n        } else {\n          right.traverse(iifeVisitor, state);\n        }\n      }\n\n      pushDefNode(left.node, right.node, i);\n    }\n\n    for (var _i2 = lastNonDefaultParam + 1; _i2 < node.params.length; _i2++) {\n      var _param = node.params[_i2];\n      if (_param._isDefaultPlaceholder) continue;\n\n      var declar = buildCutOff(_param, argsIdentifier, t.numericLiteral(_i2));\n      declar._blockHoist = node.params.length - _i2;\n      body.push(declar);\n    }\n\n    node.params = node.params.slice(0, lastNonDefaultParam);\n\n    if (state.iife) {\n      body.push((0, _babelHelperCallDelegate2.default)(path, scope));\n      path.set(\"body\", t.blockStatement(body));\n    } else {\n      path.get(\"body\").unshiftContainer(\"body\", body);\n    }\n  }\n};"]}