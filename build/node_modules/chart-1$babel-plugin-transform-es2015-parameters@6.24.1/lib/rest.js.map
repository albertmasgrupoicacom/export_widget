{"version":3,"sources":["rest.js"],"names":["exports","__esModule","visitor","undefined","_getIterator2","require","_getIterator3","_interopRequireDefault","_babelTemplate","_babelTemplate2","_babelTypes","t","_interopRequireWildcard","obj","newObj","key","Object","prototype","hasOwnProperty","call","default","buildRest","restIndex","restIndexImpure","restLength","memberExpressionOptimisationVisitor","Scope","path","state","scope","bindingIdentifierEquals","name","outerBinding","skip","Flow","isTypeCastExpression","FunctionClassProperty","oldNoOptimise","noOptimise","traverse","ReferencedIdentifier","node","deopted","parentPath","listKey","offset","isMemberExpression","object","grandparentPath","argsOptEligible","isAssignmentExpression","left","isLVal","isForXStatement","isUpdateExpression","isUnaryExpression","operator","isCallExpression","isNewExpression","callee","computed","get","isBaseType","candidates","push","cause","property","isSpreadElement","arguments","length","references","BindingIdentifier","_ref","hasRest","isRestElement","params","optimiseIndexGetter","argsId","index","isNumericLiteral","parent","numericLiteral","value","binaryExpression","isPure","temp","generateUidIdentifierBasedOnNode","id","kind","replaceWith","ARGUMENTS","INDEX","REF","optimiseLengthGetter","OFFSET","Function","rest","pop","argument","identifier","_shadowedFunctionLiteral","argumentsNode","getBindingIdentifier","_iterator","_isArray","Array","isArray","_i","_ref3","next","done","_ref4","_path","concat","map","_ref5","shadow","start","generateUidIdentifier","len","arrKey","arrLen","conditionalExpression","loop","ARRAY_KEY","ARRAY_LEN","START","ARRAY","KEY","LEN","_blockHoist","body","unshift","target","getEarliestCommonAncestorFrom","getStatementParent","findParent","isLoop","isFunction","insertBefore"],"mappings":"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","file":"rest.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\nexports.visitor = undefined;\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _babelTemplate = require(\"babel-template\");\n\nvar _babelTemplate2 = _interopRequireDefault(_babelTemplate);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar buildRest = (0, _babelTemplate2.default)(\"\\n  for (var LEN = ARGUMENTS.length,\\n           ARRAY = Array(ARRAY_LEN),\\n           KEY = START;\\n       KEY < LEN;\\n       KEY++) {\\n    ARRAY[ARRAY_KEY] = ARGUMENTS[KEY];\\n  }\\n\");\n\nvar restIndex = (0, _babelTemplate2.default)(\"\\n  ARGUMENTS.length <= INDEX ? undefined : ARGUMENTS[INDEX]\\n\");\n\nvar restIndexImpure = (0, _babelTemplate2.default)(\"\\n  REF = INDEX, ARGUMENTS.length <= REF ? undefined : ARGUMENTS[REF]\\n\");\n\nvar restLength = (0, _babelTemplate2.default)(\"\\n  ARGUMENTS.length <= OFFSET ? 0 : ARGUMENTS.length - OFFSET\\n\");\n\nvar memberExpressionOptimisationVisitor = {\n  Scope: function Scope(path, state) {\n    if (!path.scope.bindingIdentifierEquals(state.name, state.outerBinding)) {\n      path.skip();\n    }\n  },\n  Flow: function Flow(path) {\n    if (path.isTypeCastExpression()) return;\n\n    path.skip();\n  },\n\n\n  \"Function|ClassProperty\": function FunctionClassProperty(path, state) {\n    var oldNoOptimise = state.noOptimise;\n    state.noOptimise = true;\n    path.traverse(memberExpressionOptimisationVisitor, state);\n    state.noOptimise = oldNoOptimise;\n\n    path.skip();\n  },\n\n  ReferencedIdentifier: function ReferencedIdentifier(path, state) {\n    var node = path.node;\n\n    if (node.name === \"arguments\") {\n      state.deopted = true;\n    }\n\n    if (node.name !== state.name) return;\n\n    if (state.noOptimise) {\n      state.deopted = true;\n    } else {\n      var parentPath = path.parentPath;\n\n      if (parentPath.listKey === \"params\" && parentPath.key < state.offset) {\n        return;\n      }\n\n      if (parentPath.isMemberExpression({ object: node })) {\n        var grandparentPath = parentPath.parentPath;\n\n        var argsOptEligible = !state.deopted && !(grandparentPath.isAssignmentExpression() && parentPath.node === grandparentPath.node.left || grandparentPath.isLVal() || grandparentPath.isForXStatement() || grandparentPath.isUpdateExpression() || grandparentPath.isUnaryExpression({ operator: \"delete\" }) || (grandparentPath.isCallExpression() || grandparentPath.isNewExpression()) && parentPath.node === grandparentPath.node.callee);\n\n        if (argsOptEligible) {\n          if (parentPath.node.computed) {\n            if (parentPath.get(\"property\").isBaseType(\"number\")) {\n              state.candidates.push({ cause: \"indexGetter\", path: path });\n              return;\n            }\n          } else if (parentPath.node.property.name === \"length\") {\n              state.candidates.push({ cause: \"lengthGetter\", path: path });\n              return;\n            }\n        }\n      }\n\n      if (state.offset === 0 && parentPath.isSpreadElement()) {\n        var call = parentPath.parentPath;\n        if (call.isCallExpression() && call.node.arguments.length === 1) {\n          state.candidates.push({ cause: \"argSpread\", path: path });\n          return;\n        }\n      }\n\n      state.references.push(path);\n    }\n  },\n  BindingIdentifier: function BindingIdentifier(_ref, state) {\n    var node = _ref.node;\n\n    if (node.name === state.name) {\n      state.deopted = true;\n    }\n  }\n};\nfunction hasRest(node) {\n  return t.isRestElement(node.params[node.params.length - 1]);\n}\n\nfunction optimiseIndexGetter(path, argsId, offset) {\n  var index = void 0;\n\n  if (t.isNumericLiteral(path.parent.property)) {\n    index = t.numericLiteral(path.parent.property.value + offset);\n  } else if (offset === 0) {\n    index = path.parent.property;\n  } else {\n    index = t.binaryExpression(\"+\", path.parent.property, t.numericLiteral(offset));\n  }\n\n  var scope = path.scope;\n\n  if (!scope.isPure(index)) {\n    var temp = scope.generateUidIdentifierBasedOnNode(index);\n    scope.push({ id: temp, kind: \"var\" });\n    path.parentPath.replaceWith(restIndexImpure({\n      ARGUMENTS: argsId,\n      INDEX: index,\n      REF: temp\n    }));\n  } else {\n    path.parentPath.replaceWith(restIndex({\n      ARGUMENTS: argsId,\n      INDEX: index\n    }));\n  }\n}\n\nfunction optimiseLengthGetter(path, argsId, offset) {\n  if (offset) {\n    path.parentPath.replaceWith(restLength({\n      ARGUMENTS: argsId,\n      OFFSET: t.numericLiteral(offset)\n    }));\n  } else {\n    path.replaceWith(argsId);\n  }\n}\n\nvar visitor = exports.visitor = {\n  Function: function Function(path) {\n    var node = path.node,\n        scope = path.scope;\n\n    if (!hasRest(node)) return;\n\n    var rest = node.params.pop().argument;\n\n    var argsId = t.identifier(\"arguments\");\n\n    argsId._shadowedFunctionLiteral = path;\n\n    var state = {\n      references: [],\n      offset: node.params.length,\n\n      argumentsNode: argsId,\n      outerBinding: scope.getBindingIdentifier(rest.name),\n\n      candidates: [],\n\n      name: rest.name,\n\n      deopted: false\n    };\n\n    path.traverse(memberExpressionOptimisationVisitor, state);\n\n    if (!state.deopted && !state.references.length) {\n      for (var _iterator = state.candidates, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : (0, _getIterator3.default)(_iterator);;) {\n        var _ref3;\n\n        if (_isArray) {\n          if (_i >= _iterator.length) break;\n          _ref3 = _iterator[_i++];\n        } else {\n          _i = _iterator.next();\n          if (_i.done) break;\n          _ref3 = _i.value;\n        }\n\n        var _ref4 = _ref3;\n        var _path = _ref4.path,\n            cause = _ref4.cause;\n\n        switch (cause) {\n          case \"indexGetter\":\n            optimiseIndexGetter(_path, argsId, state.offset);\n            break;\n          case \"lengthGetter\":\n            optimiseLengthGetter(_path, argsId, state.offset);\n            break;\n          default:\n            _path.replaceWith(argsId);\n        }\n      }\n      return;\n    }\n\n    state.references = state.references.concat(state.candidates.map(function (_ref5) {\n      var path = _ref5.path;\n      return path;\n    }));\n\n    state.deopted = state.deopted || !!node.shadow;\n\n    var start = t.numericLiteral(node.params.length);\n    var key = scope.generateUidIdentifier(\"key\");\n    var len = scope.generateUidIdentifier(\"len\");\n\n    var arrKey = key;\n    var arrLen = len;\n    if (node.params.length) {\n      arrKey = t.binaryExpression(\"-\", key, start);\n\n      arrLen = t.conditionalExpression(t.binaryExpression(\">\", len, start), t.binaryExpression(\"-\", len, start), t.numericLiteral(0));\n    }\n\n    var loop = buildRest({\n      ARGUMENTS: argsId,\n      ARRAY_KEY: arrKey,\n      ARRAY_LEN: arrLen,\n      START: start,\n      ARRAY: rest,\n      KEY: key,\n      LEN: len\n    });\n\n    if (state.deopted) {\n      loop._blockHoist = node.params.length + 1;\n      node.body.body.unshift(loop);\n    } else {\n      loop._blockHoist = 1;\n\n      var target = path.getEarliestCommonAncestorFrom(state.references).getStatementParent();\n\n      target.findParent(function (path) {\n        if (path.isLoop()) {\n          target = path;\n        } else {\n          return path.isFunction();\n        }\n      });\n\n      target.insertBefore(loop);\n    }\n  }\n};"]}