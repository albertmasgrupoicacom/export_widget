{"version":3,"sources":["index.js"],"names":["exports","__esModule","_create","require","_create2","_interopRequireDefault","default","_ref","t","types","isValidRequireCall","path","isCallExpression","get","isIdentifier","name","scope","getBinding","args","length","arg","isStringLiteral","amdVisitor","ReferencedIdentifier","_ref2","node","hasExports","hasModule","CallExpression","bareSources","push","arguments","remove","VariableDeclarator","id","init","source","sourceNames","value","sources","inherits","pre","visitor","Program","exit","_this","ran","traverse","params","map","concat","filter","str","moduleName","getModuleName","stringLiteral","unshift","identifier","factory","buildFactory","PARAMS","BODY","body","expression","directives","buildDefine","MODULE_NAME","SOURCES","FACTORY","_babelTemplate","_babelTemplate2","obj","module"],"mappings":"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","file":"index.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _create = require(\"babel-runtime/core-js/object/create\");\n\nvar _create2 = _interopRequireDefault(_create);\n\nexports.default = function (_ref) {\n  var t = _ref.types;\n\n  function isValidRequireCall(path) {\n    if (!path.isCallExpression()) return false;\n    if (!path.get(\"callee\").isIdentifier({ name: \"require\" })) return false;\n    if (path.scope.getBinding(\"require\")) return false;\n\n    var args = path.get(\"arguments\");\n    if (args.length !== 1) return false;\n\n    var arg = args[0];\n    if (!arg.isStringLiteral()) return false;\n\n    return true;\n  }\n\n  var amdVisitor = {\n    ReferencedIdentifier: function ReferencedIdentifier(_ref2) {\n      var node = _ref2.node,\n          scope = _ref2.scope;\n\n      if (node.name === \"exports\" && !scope.getBinding(\"exports\")) {\n        this.hasExports = true;\n      }\n\n      if (node.name === \"module\" && !scope.getBinding(\"module\")) {\n        this.hasModule = true;\n      }\n    },\n    CallExpression: function CallExpression(path) {\n      if (!isValidRequireCall(path)) return;\n      this.bareSources.push(path.node.arguments[0]);\n      path.remove();\n    },\n    VariableDeclarator: function VariableDeclarator(path) {\n      var id = path.get(\"id\");\n      if (!id.isIdentifier()) return;\n\n      var init = path.get(\"init\");\n      if (!isValidRequireCall(init)) return;\n\n      var source = init.node.arguments[0];\n      this.sourceNames[source.value] = true;\n      this.sources.push([id.node, source]);\n\n      path.remove();\n    }\n  };\n\n  return {\n    inherits: require(\"babel-plugin-transform-es2015-modules-commonjs\"),\n\n    pre: function pre() {\n      this.sources = [];\n      this.sourceNames = (0, _create2.default)(null);\n\n      this.bareSources = [];\n\n      this.hasExports = false;\n      this.hasModule = false;\n    },\n\n\n    visitor: {\n      Program: {\n        exit: function exit(path) {\n          var _this = this;\n\n          if (this.ran) return;\n          this.ran = true;\n\n          path.traverse(amdVisitor, this);\n\n          var params = this.sources.map(function (source) {\n            return source[0];\n          });\n          var sources = this.sources.map(function (source) {\n            return source[1];\n          });\n\n          sources = sources.concat(this.bareSources.filter(function (str) {\n            return !_this.sourceNames[str.value];\n          }));\n\n          var moduleName = this.getModuleName();\n          if (moduleName) moduleName = t.stringLiteral(moduleName);\n\n          if (this.hasExports) {\n            sources.unshift(t.stringLiteral(\"exports\"));\n            params.unshift(t.identifier(\"exports\"));\n          }\n\n          if (this.hasModule) {\n            sources.unshift(t.stringLiteral(\"module\"));\n            params.unshift(t.identifier(\"module\"));\n          }\n\n          var node = path.node;\n\n          var factory = buildFactory({\n            PARAMS: params,\n            BODY: node.body\n          });\n          factory.expression.body.directives = node.directives;\n          node.directives = [];\n\n          node.body = [buildDefine({\n            MODULE_NAME: moduleName,\n            SOURCES: sources,\n            FACTORY: factory\n          })];\n        }\n      }\n    }\n  };\n};\n\nvar _babelTemplate = require(\"babel-template\");\n\nvar _babelTemplate2 = _interopRequireDefault(_babelTemplate);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar buildDefine = (0, _babelTemplate2.default)(\"\\n  define(MODULE_NAME, [SOURCES], FACTORY);\\n\");\n\nvar buildFactory = (0, _babelTemplate2.default)(\"\\n  (function (PARAMS) {\\n    BODY;\\n  })\\n\");\n\nmodule.exports = exports[\"default\"];"]}