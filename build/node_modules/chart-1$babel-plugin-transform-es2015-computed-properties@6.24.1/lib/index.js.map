{"version":3,"sources":["index.js"],"names":["exports","__esModule","_getIterator2","require","_getIterator3","_interopRequireDefault","default","_ref","t","types","template","buildMutatorMapAssign","getValue","prop","isObjectProperty","value","isObjectMethod","functionExpression","params","body","generator","async","pushAssign","objId","kind","pushMutatorDefine","push","expressionStatement","assignmentExpression","memberExpression","key","computed","isLiteral","_ref2","getMutatorId","scope","isIdentifier","stringLiteral","name","maybeMemoise","maybeGenerateMemoised","apply","MUTATOR_MAP_REF","KEY","VALUE","KIND","identifier","loose","info","_iterator","computedProps","_isArray","Array","isArray","_i","_ref3","length","next","done","spec","state","_iterator2","_isArray2","_i2","_ref4","toComputedKey","isStringLiteral","callExpression","addHelper","initPropExpression","visitor","ObjectExpression","exit","path","node","parent","hasComputed","_iterator3","properties","_isArray3","_i3","_ref5","initProps","foundComputed","_iterator4","_isArray4","_i4","_ref6","_prop","generateUidIdentifierBasedOnNode","objectExpression","variableDeclaration","variableDeclarator","callback","opts","mutatorRef","generateUidIdentifier","single","replaceWith","replaceWithMultiple","obj","module"],"mappings":"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","file":"index.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nexports.default = function (_ref) {\n  var t = _ref.types,\n      template = _ref.template;\n\n  var buildMutatorMapAssign = template(\"\\n    MUTATOR_MAP_REF[KEY] = MUTATOR_MAP_REF[KEY] || {};\\n    MUTATOR_MAP_REF[KEY].KIND = VALUE;\\n  \");\n\n  function getValue(prop) {\n    if (t.isObjectProperty(prop)) {\n      return prop.value;\n    } else if (t.isObjectMethod(prop)) {\n      return t.functionExpression(null, prop.params, prop.body, prop.generator, prop.async);\n    }\n  }\n\n  function pushAssign(objId, prop, body) {\n    if (prop.kind === \"get\" && prop.kind === \"set\") {\n      pushMutatorDefine(objId, prop, body);\n    } else {\n      body.push(t.expressionStatement(t.assignmentExpression(\"=\", t.memberExpression(objId, prop.key, prop.computed || t.isLiteral(prop.key)), getValue(prop))));\n    }\n  }\n\n  function pushMutatorDefine(_ref2, prop) {\n    var objId = _ref2.objId,\n        body = _ref2.body,\n        getMutatorId = _ref2.getMutatorId,\n        scope = _ref2.scope;\n\n    var key = !prop.computed && t.isIdentifier(prop.key) ? t.stringLiteral(prop.key.name) : prop.key;\n\n    var maybeMemoise = scope.maybeGenerateMemoised(key);\n    if (maybeMemoise) {\n      body.push(t.expressionStatement(t.assignmentExpression(\"=\", maybeMemoise, key)));\n      key = maybeMemoise;\n    }\n\n    body.push.apply(body, buildMutatorMapAssign({\n      MUTATOR_MAP_REF: getMutatorId(),\n      KEY: key,\n      VALUE: getValue(prop),\n      KIND: t.identifier(prop.kind)\n    }));\n  }\n\n  function loose(info) {\n    for (var _iterator = info.computedProps, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : (0, _getIterator3.default)(_iterator);;) {\n      var _ref3;\n\n      if (_isArray) {\n        if (_i >= _iterator.length) break;\n        _ref3 = _iterator[_i++];\n      } else {\n        _i = _iterator.next();\n        if (_i.done) break;\n        _ref3 = _i.value;\n      }\n\n      var prop = _ref3;\n\n      if (prop.kind === \"get\" || prop.kind === \"set\") {\n        pushMutatorDefine(info, prop);\n      } else {\n        pushAssign(info.objId, prop, info.body);\n      }\n    }\n  }\n\n  function spec(info) {\n    var objId = info.objId,\n        body = info.body,\n        computedProps = info.computedProps,\n        state = info.state;\n\n\n    for (var _iterator2 = computedProps, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : (0, _getIterator3.default)(_iterator2);;) {\n      var _ref4;\n\n      if (_isArray2) {\n        if (_i2 >= _iterator2.length) break;\n        _ref4 = _iterator2[_i2++];\n      } else {\n        _i2 = _iterator2.next();\n        if (_i2.done) break;\n        _ref4 = _i2.value;\n      }\n\n      var prop = _ref4;\n\n      var key = t.toComputedKey(prop);\n\n      if (prop.kind === \"get\" || prop.kind === \"set\") {\n        pushMutatorDefine(info, prop);\n      } else if (t.isStringLiteral(key, { value: \"__proto__\" })) {\n        pushAssign(objId, prop, body);\n      } else {\n        if (computedProps.length === 1) {\n          return t.callExpression(state.addHelper(\"defineProperty\"), [info.initPropExpression, key, getValue(prop)]);\n        } else {\n          body.push(t.expressionStatement(t.callExpression(state.addHelper(\"defineProperty\"), [objId, key, getValue(prop)])));\n        }\n      }\n    }\n  }\n\n  return {\n    visitor: {\n      ObjectExpression: {\n        exit: function exit(path, state) {\n          var node = path.node,\n              parent = path.parent,\n              scope = path.scope;\n\n          var hasComputed = false;\n          for (var _iterator3 = node.properties, _isArray3 = Array.isArray(_iterator3), _i3 = 0, _iterator3 = _isArray3 ? _iterator3 : (0, _getIterator3.default)(_iterator3);;) {\n            var _ref5;\n\n            if (_isArray3) {\n              if (_i3 >= _iterator3.length) break;\n              _ref5 = _iterator3[_i3++];\n            } else {\n              _i3 = _iterator3.next();\n              if (_i3.done) break;\n              _ref5 = _i3.value;\n            }\n\n            var prop = _ref5;\n\n            hasComputed = prop.computed === true;\n            if (hasComputed) break;\n          }\n          if (!hasComputed) return;\n\n          var initProps = [];\n          var computedProps = [];\n          var foundComputed = false;\n\n          for (var _iterator4 = node.properties, _isArray4 = Array.isArray(_iterator4), _i4 = 0, _iterator4 = _isArray4 ? _iterator4 : (0, _getIterator3.default)(_iterator4);;) {\n            var _ref6;\n\n            if (_isArray4) {\n              if (_i4 >= _iterator4.length) break;\n              _ref6 = _iterator4[_i4++];\n            } else {\n              _i4 = _iterator4.next();\n              if (_i4.done) break;\n              _ref6 = _i4.value;\n            }\n\n            var _prop = _ref6;\n\n            if (_prop.computed) {\n              foundComputed = true;\n            }\n\n            if (foundComputed) {\n              computedProps.push(_prop);\n            } else {\n              initProps.push(_prop);\n            }\n          }\n\n          var objId = scope.generateUidIdentifierBasedOnNode(parent);\n          var initPropExpression = t.objectExpression(initProps);\n          var body = [];\n\n          body.push(t.variableDeclaration(\"var\", [t.variableDeclarator(objId, initPropExpression)]));\n\n          var callback = spec;\n          if (state.opts.loose) callback = loose;\n\n          var mutatorRef = void 0;\n\n          var getMutatorId = function getMutatorId() {\n            if (!mutatorRef) {\n              mutatorRef = scope.generateUidIdentifier(\"mutatorMap\");\n\n              body.push(t.variableDeclaration(\"var\", [t.variableDeclarator(mutatorRef, t.objectExpression([]))]));\n            }\n\n            return mutatorRef;\n          };\n\n          var single = callback({\n            scope: scope,\n            objId: objId,\n            body: body,\n            computedProps: computedProps,\n            initPropExpression: initPropExpression,\n            getMutatorId: getMutatorId,\n            state: state\n          });\n\n          if (mutatorRef) {\n            body.push(t.expressionStatement(t.callExpression(state.addHelper(\"defineEnumerableProperties\"), [objId, mutatorRef])));\n          }\n\n          if (single) {\n            path.replaceWith(single);\n          } else {\n            body.push(t.expressionStatement(objId));\n            path.replaceWithMultiple(body);\n          }\n        }\n      }\n    }\n  };\n};\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nmodule.exports = exports[\"default\"];"]}