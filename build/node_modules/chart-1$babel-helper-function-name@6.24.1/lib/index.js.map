{"version":3,"sources":["index.js"],"names":["exports","__esModule","default","_ref","node","parent","scope","id","t","isObjectProperty","isObjectMethod","kind","computed","isLiteral","key","isVariableDeclarator","isIdentifier","binding","getBinding","name","constant","NOT_LOCAL_BINDING","isAssignmentExpression","left","value","toBindingIdentifierName","identifier","state","visit","wrap","_babelHelperGetFunctionArity","require","_babelHelperGetFunctionArity2","_interopRequireDefault","_babelTemplate","_babelTemplate2","_babelTypes","_interopRequireWildcard","obj","newObj","Object","prototype","hasOwnProperty","call","buildPropertyMethodAssignmentWrapper","buildGeneratorPropertyMethodAssignmentWrapper","visitor","ReferencedIdentifierBindingIdentifier","path","localDeclar","getBindingIdentifier","outerDeclar","selfReference","stop","method","hasBinding","hasGlobal","rename","isFunction","build","generator","_template","FUNCTION","FUNCTION_ID","FUNCTION_KEY","generateUidIdentifier","expression","callee","_skipModulesRemap","params","body","i","len","push","getProgramParent","references","selfAssignment","getOwnBinding","traverse","module"],"mappings":"AAAA;;;;;;AAEAA,YAAQC,UAAR,GAAqB,IAArB;;AAEAD,YAAQE,OAAR,GAAkB,UAAUC,IAAV,EAAgB;AAChC,UAAIC,OAAOD,KAAKC,IAAhB;AAAA,UACIC,SAASF,KAAKE,MADlB;AAAA,UAEIC,QAAQH,KAAKG,KAFjB;AAAA,UAGIC,KAAKJ,KAAKI,EAHd;;AAKA,UAAIH,KAAKG,EAAT,EAAa;;AAEb,UAAI,CAACC,EAAEC,gBAAF,CAAmBJ,MAAnB,KAA8BG,EAAEE,cAAF,CAAiBL,MAAjB,EAAyB,EAAEM,MAAM,QAAR,EAAzB,CAA/B,MAAiF,CAACN,OAAOO,QAAR,IAAoBJ,EAAEK,SAAF,CAAYR,OAAOS,GAAnB,CAArG,CAAJ,EAAmI;AACjIP,aAAKF,OAAOS,GAAZ;AACD,OAFD,MAEO,IAAIN,EAAEO,oBAAF,CAAuBV,MAAvB,CAAJ,EAAoC;AACzCE,aAAKF,OAAOE,EAAZ;;AAEA,YAAIC,EAAEQ,YAAF,CAAeT,EAAf,CAAJ,EAAwB;AACtB,cAAIU,UAAUX,MAAMD,MAAN,CAAaa,UAAb,CAAwBX,GAAGY,IAA3B,CAAd;AACA,cAAIF,WAAWA,QAAQG,QAAnB,IAA+Bd,MAAMY,UAAN,CAAiBX,GAAGY,IAApB,MAA8BF,OAAjE,EAA0E;AACxEb,iBAAKG,EAAL,GAAUA,EAAV;AACAH,iBAAKG,EAAL,CAAQC,EAAEa,iBAAV,IAA+B,IAA/B;AACA;AACD;AACF;AACF,OAXM,MAWA,IAAIb,EAAEc,sBAAF,CAAyBjB,MAAzB,CAAJ,EAAsC;AAC3CE,aAAKF,OAAOkB,IAAZ;AACD,OAFM,MAEA,IAAI,CAAChB,EAAL,EAAS;AACd;AACD;;AAED,UAAIY,OAAO,KAAK,CAAhB;AACA,UAAIZ,MAAMC,EAAEK,SAAF,CAAYN,EAAZ,CAAV,EAA2B;AACzBY,eAAOZ,GAAGiB,KAAV;AACD,OAFD,MAEO,IAAIjB,MAAMC,EAAEQ,YAAF,CAAeT,EAAf,CAAV,EAA8B;AACnCY,eAAOZ,GAAGY,IAAV;AACD,OAFM,MAEA;AACL;AACD;;AAEDA,aAAOX,EAAEiB,uBAAF,CAA0BN,IAA1B,CAAP;AACAZ,WAAKC,EAAEkB,UAAF,CAAaP,IAAb,CAAL;;AAEAZ,SAAGC,EAAEa,iBAAL,IAA0B,IAA1B;;AAEA,UAAIM,QAAQC,MAAMxB,IAAN,EAAYe,IAAZ,EAAkBb,KAAlB,CAAZ;AACA,aAAOuB,KAAKF,KAAL,EAAYvB,IAAZ,EAAkBG,EAAlB,EAAsBD,KAAtB,KAAgCF,IAAvC;AACD,KA3CD;;AA6CA,QAAI0B,+BAA+BC,QAAQ,yCAAR,CAAnC;;AAEA,QAAIC,gCAAgCC,uBAAuBH,4BAAvB,CAApC;;AAEA,QAAII,iBAAiBH,QAAQ,wBAAR,CAArB;;AAEA,QAAII,kBAAkBF,uBAAuBC,cAAvB,CAAtB;;AAEA,QAAIE,cAAcL,QAAQ,qBAAR,CAAlB;;AAEA,QAAIvB,IAAI6B,wBAAwBD,WAAxB,CAAR;;AAEA,aAASC,uBAAT,CAAiCC,GAAjC,EAAsC;AAAE,UAAIA,OAAOA,IAAIrC,UAAf,EAA2B;AAAE,eAAOqC,GAAP;AAAa,OAA1C,MAAgD;AAAE,YAAIC,SAAS,EAAb,CAAiB,IAAID,OAAO,IAAX,EAAiB;AAAE,eAAK,IAAIxB,GAAT,IAAgBwB,GAAhB,EAAqB;AAAE,gBAAIE,OAAOC,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCL,GAArC,EAA0CxB,GAA1C,CAAJ,EAAoDyB,OAAOzB,GAAP,IAAcwB,IAAIxB,GAAJ,CAAd;AAAyB;AAAE,SAACyB,OAAOrC,OAAP,GAAiBoC,GAAjB,CAAsB,OAAOC,MAAP;AAAgB;AAAE;;AAE7Q,aAASN,sBAAT,CAAgCK,GAAhC,EAAqC;AAAE,aAAOA,OAAOA,IAAIrC,UAAX,GAAwBqC,GAAxB,GAA8B,EAAEpC,SAASoC,GAAX,EAArC;AAAwD;;AAE/F,QAAIM,uCAAuC,CAAC,GAAGT,gBAAgBjC,OAApB,EAA6B,+PAA7B,CAA3C;;AAEA,QAAI2C,gDAAgD,CAAC,GAAGV,gBAAgBjC,OAApB,EAA6B,wQAA7B,CAApD;;AAEA,QAAI4C,UAAU;AACZ,gDAA0C,SAASC,qCAAT,CAA+CC,IAA/C,EAAqDrB,KAArD,EAA4D;AACpG,YAAIqB,KAAK5C,IAAL,CAAUe,IAAV,KAAmBQ,MAAMR,IAA7B,EAAmC;;AAEnC,YAAI8B,cAAcD,KAAK1C,KAAL,CAAW4C,oBAAX,CAAgCvB,MAAMR,IAAtC,CAAlB;AACA,YAAI8B,gBAAgBtB,MAAMwB,WAA1B,EAAuC;;AAEvCxB,cAAMyB,aAAN,GAAsB,IAAtB;AACAJ,aAAKK,IAAL;AACD;AATW,KAAd;;AAYA,aAASxB,IAAT,CAAcF,KAAd,EAAqB2B,MAArB,EAA6B/C,EAA7B,EAAiCD,KAAjC,EAAwC;AACtC,UAAIqB,MAAMyB,aAAV,EAAyB;AACvB,YAAI9C,MAAMiD,UAAN,CAAiBhD,GAAGY,IAApB,KAA6B,CAACb,MAAMkD,SAAN,CAAgBjD,GAAGY,IAAnB,CAAlC,EAA4D;AAC1Db,gBAAMmD,MAAN,CAAalD,GAAGY,IAAhB;AACD,SAFD,MAEO;AACL,cAAI,CAACX,EAAEkD,UAAF,CAAaJ,MAAb,CAAL,EAA2B;;AAE3B,cAAIK,QAAQf,oCAAZ;AACA,cAAIU,OAAOM,SAAX,EAAsBD,QAAQd,6CAAR;AACtB,cAAIgB,YAAYF,MAAM;AACpBG,sBAAUR,MADU;AAEpBS,yBAAaxD,EAFO;AAGpByD,0BAAc1D,MAAM2D,qBAAN,CAA4B1D,GAAGY,IAA/B;AAHM,WAAN,EAIb+C,UAJH;AAKAL,oBAAUM,MAAV,CAAiBC,iBAAjB,GAAqC,IAArC;;AAEA,cAAIC,SAASR,UAAUM,MAAV,CAAiBG,IAAjB,CAAsBA,IAAtB,CAA2B,CAA3B,EAA8BD,MAA3C;AACA,eAAK,IAAIE,IAAI,CAAR,EAAWC,MAAM,CAAC,GAAGxC,8BAA8B9B,OAAlC,EAA2CoD,MAA3C,CAAtB,EAA0EiB,IAAIC,GAA9E,EAAmFD,GAAnF,EAAwF;AACtFF,mBAAOI,IAAP,CAAYnE,MAAM2D,qBAAN,CAA4B,GAA5B,CAAZ;AACD;;AAED,iBAAOJ,SAAP;AACD;AACF;;AAEDP,aAAO/C,EAAP,GAAYA,EAAZ;AACAD,YAAMoE,gBAAN,GAAyBC,UAAzB,CAAoCpE,GAAGY,IAAvC,IAA+C,IAA/C;AACD;;AAED,aAASS,KAAT,CAAexB,IAAf,EAAqBe,IAArB,EAA2Bb,KAA3B,EAAkC;AAChC,UAAIqB,QAAQ;AACViD,wBAAgB,KADN;AAEVxB,uBAAe,KAFL;AAGVD,qBAAa7C,MAAM4C,oBAAN,CAA2B/B,IAA3B,CAHH;AAIVwD,oBAAY,EAJF;AAKVxD,cAAMA;AALI,OAAZ;;AAQA,UAAIF,UAAUX,MAAMuE,aAAN,CAAoB1D,IAApB,CAAd;;AAEA,UAAIF,OAAJ,EAAa;AACX,YAAIA,QAAQN,IAAR,KAAiB,OAArB,EAA8B;AAC5BgB,gBAAMyB,aAAN,GAAsB,IAAtB;AACD;AACF,OAJD,MAIO,IAAIzB,MAAMwB,WAAN,IAAqB7C,MAAMkD,SAAN,CAAgBrC,IAAhB,CAAzB,EAAgD;AACrDb,cAAMwE,QAAN,CAAe1E,IAAf,EAAqB0C,OAArB,EAA8BnB,KAA9B;AACD;;AAED,aAAOA,KAAP;AACD;;AAEDoD,WAAO/E,OAAP,GAAiBA,QAAQ,SAAR,CAAjB","file":"index.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nexports.default = function (_ref) {\n  var node = _ref.node,\n      parent = _ref.parent,\n      scope = _ref.scope,\n      id = _ref.id;\n\n  if (node.id) return;\n\n  if ((t.isObjectProperty(parent) || t.isObjectMethod(parent, { kind: \"method\" })) && (!parent.computed || t.isLiteral(parent.key))) {\n    id = parent.key;\n  } else if (t.isVariableDeclarator(parent)) {\n    id = parent.id;\n\n    if (t.isIdentifier(id)) {\n      var binding = scope.parent.getBinding(id.name);\n      if (binding && binding.constant && scope.getBinding(id.name) === binding) {\n        node.id = id;\n        node.id[t.NOT_LOCAL_BINDING] = true;\n        return;\n      }\n    }\n  } else if (t.isAssignmentExpression(parent)) {\n    id = parent.left;\n  } else if (!id) {\n    return;\n  }\n\n  var name = void 0;\n  if (id && t.isLiteral(id)) {\n    name = id.value;\n  } else if (id && t.isIdentifier(id)) {\n    name = id.name;\n  } else {\n    return;\n  }\n\n  name = t.toBindingIdentifierName(name);\n  id = t.identifier(name);\n\n  id[t.NOT_LOCAL_BINDING] = true;\n\n  var state = visit(node, name, scope);\n  return wrap(state, node, id, scope) || node;\n};\n\nvar _babelHelperGetFunctionArity = require(\"babel-helper-get-function-arity\");\n\nvar _babelHelperGetFunctionArity2 = _interopRequireDefault(_babelHelperGetFunctionArity);\n\nvar _babelTemplate = require(\"babel-template\");\n\nvar _babelTemplate2 = _interopRequireDefault(_babelTemplate);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar buildPropertyMethodAssignmentWrapper = (0, _babelTemplate2.default)(\"\\n  (function (FUNCTION_KEY) {\\n    function FUNCTION_ID() {\\n      return FUNCTION_KEY.apply(this, arguments);\\n    }\\n\\n    FUNCTION_ID.toString = function () {\\n      return FUNCTION_KEY.toString();\\n    }\\n\\n    return FUNCTION_ID;\\n  })(FUNCTION)\\n\");\n\nvar buildGeneratorPropertyMethodAssignmentWrapper = (0, _babelTemplate2.default)(\"\\n  (function (FUNCTION_KEY) {\\n    function* FUNCTION_ID() {\\n      return yield* FUNCTION_KEY.apply(this, arguments);\\n    }\\n\\n    FUNCTION_ID.toString = function () {\\n      return FUNCTION_KEY.toString();\\n    };\\n\\n    return FUNCTION_ID;\\n  })(FUNCTION)\\n\");\n\nvar visitor = {\n  \"ReferencedIdentifier|BindingIdentifier\": function ReferencedIdentifierBindingIdentifier(path, state) {\n    if (path.node.name !== state.name) return;\n\n    var localDeclar = path.scope.getBindingIdentifier(state.name);\n    if (localDeclar !== state.outerDeclar) return;\n\n    state.selfReference = true;\n    path.stop();\n  }\n};\n\nfunction wrap(state, method, id, scope) {\n  if (state.selfReference) {\n    if (scope.hasBinding(id.name) && !scope.hasGlobal(id.name)) {\n      scope.rename(id.name);\n    } else {\n      if (!t.isFunction(method)) return;\n\n      var build = buildPropertyMethodAssignmentWrapper;\n      if (method.generator) build = buildGeneratorPropertyMethodAssignmentWrapper;\n      var _template = build({\n        FUNCTION: method,\n        FUNCTION_ID: id,\n        FUNCTION_KEY: scope.generateUidIdentifier(id.name)\n      }).expression;\n      _template.callee._skipModulesRemap = true;\n\n      var params = _template.callee.body.body[0].params;\n      for (var i = 0, len = (0, _babelHelperGetFunctionArity2.default)(method); i < len; i++) {\n        params.push(scope.generateUidIdentifier(\"x\"));\n      }\n\n      return _template;\n    }\n  }\n\n  method.id = id;\n  scope.getProgramParent().references[id.name] = true;\n}\n\nfunction visit(node, name, scope) {\n  var state = {\n    selfAssignment: false,\n    selfReference: false,\n    outerDeclar: scope.getBindingIdentifier(name),\n    references: [],\n    name: name\n  };\n\n  var binding = scope.getOwnBinding(name);\n\n  if (binding) {\n    if (binding.kind === \"param\") {\n      state.selfReference = true;\n    } else {}\n  } else if (state.outerDeclar || scope.hasGlobal(name)) {\n    scope.traverse(node, visitor, state);\n  }\n\n  return state;\n}\n\nmodule.exports = exports[\"default\"];"]}