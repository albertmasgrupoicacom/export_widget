{"version":3,"sources":["_collection-weak.js"],"names":["redefineAll","require","getWeak","anObject","isObject","anInstance","forOf","createArrayMethod","$has","validate","arrayFind","arrayFindIndex","id","uncaughtFrozenStore","that","_l","UncaughtFrozenStore","a","findUncaughtFrozen","store","key","it","prototype","get","entry","has","set","value","push","index","splice","module","exports","getConstructor","wrapper","NAME","IS_MAP","ADDER","C","iterable","_t","_i","undefined","data","def","ufstore"],"mappings":"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","file":"_collection-weak.js","sourcesContent":["'use strict';\nvar redefineAll = require('./_redefine-all');\nvar getWeak = require('./_meta').getWeak;\nvar anObject = require('./_an-object');\nvar isObject = require('./_is-object');\nvar anInstance = require('./_an-instance');\nvar forOf = require('./_for-of');\nvar createArrayMethod = require('./_array-methods');\nvar $has = require('./_has');\nvar validate = require('./_validate-collection');\nvar arrayFind = createArrayMethod(5);\nvar arrayFindIndex = createArrayMethod(6);\nvar id = 0;\n\n// fallback for uncaught frozen keys\nvar uncaughtFrozenStore = function (that) {\n  return that._l || (that._l = new UncaughtFrozenStore());\n};\nvar UncaughtFrozenStore = function () {\n  this.a = [];\n};\nvar findUncaughtFrozen = function (store, key) {\n  return arrayFind(store.a, function (it) {\n    return it[0] === key;\n  });\n};\nUncaughtFrozenStore.prototype = {\n  get: function (key) {\n    var entry = findUncaughtFrozen(this, key);\n    if (entry) return entry[1];\n  },\n  has: function (key) {\n    return !!findUncaughtFrozen(this, key);\n  },\n  set: function (key, value) {\n    var entry = findUncaughtFrozen(this, key);\n    if (entry) entry[1] = value;\n    else this.a.push([key, value]);\n  },\n  'delete': function (key) {\n    var index = arrayFindIndex(this.a, function (it) {\n      return it[0] === key;\n    });\n    if (~index) this.a.splice(index, 1);\n    return !!~index;\n  }\n};\n\nmodule.exports = {\n  getConstructor: function (wrapper, NAME, IS_MAP, ADDER) {\n    var C = wrapper(function (that, iterable) {\n      anInstance(that, C, NAME, '_i');\n      that._t = NAME;      // collection type\n      that._i = id++;      // collection id\n      that._l = undefined; // leak store for uncaught frozen objects\n      if (iterable != undefined) forOf(iterable, IS_MAP, that[ADDER], that);\n    });\n    redefineAll(C.prototype, {\n      // 23.3.3.2 WeakMap.prototype.delete(key)\n      // 23.4.3.3 WeakSet.prototype.delete(value)\n      'delete': function (key) {\n        if (!isObject(key)) return false;\n        var data = getWeak(key);\n        if (data === true) return uncaughtFrozenStore(validate(this, NAME))['delete'](key);\n        return data && $has(data, this._i) && delete data[this._i];\n      },\n      // 23.3.3.4 WeakMap.prototype.has(key)\n      // 23.4.3.4 WeakSet.prototype.has(value)\n      has: function has(key) {\n        if (!isObject(key)) return false;\n        var data = getWeak(key);\n        if (data === true) return uncaughtFrozenStore(validate(this, NAME)).has(key);\n        return data && $has(data, this._i);\n      }\n    });\n    return C;\n  },\n  def: function (that, key, value) {\n    var data = getWeak(anObject(key), true);\n    if (data === true) uncaughtFrozenStore(that).set(key, value);\n    else data[that._i] = value;\n    return that;\n  },\n  ufstore: uncaughtFrozenStore\n};\n"]}