{"version":3,"sources":["index.js"],"names":["exports","__esModule","default","_ref","messages","template","t","types","buildForOfArray","buildForOfLoose","buildForOf","_ForOfStatementArray","path","node","scope","nodes","right","isIdentifier","hasBinding","name","uid","generateUidIdentifier","push","variableDeclaration","variableDeclarator","iterationKey","loop","BODY","body","KEY","ARR","inherits","ensureBlock","iterationValue","memberExpression","left","isVariableDeclaration","declarations","init","unshift","expressionStatement","assignmentExpression","parentPath","isLabeledStatement","labeledStatement","label","visitor","ForOfStatement","state","get","isArrayExpression","replaceWithMultiple","callback","spec","opts","loose","build","declar","block","concat","replaceParent","remove","file","parent","id","isPattern","isMemberExpression","kind","buildCodeFrameError","type","iteratorKey","isArrayKey","LOOP_OBJECT","IS_ARRAY","OBJECT","INDEX","ID","shift","isLabeledParent","labeled","stepKey","stepValue","identifier","ITERATOR_HAD_ERROR_KEY","ITERATOR_COMPLETION","ITERATOR_ERROR_KEY","ITERATOR_KEY","STEP_KEY","tryBody","module"],"mappings":"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","file":"index.js","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nexports.default = function (_ref) {\n  var messages = _ref.messages,\n      template = _ref.template,\n      t = _ref.types;\n\n  var buildForOfArray = template(\"\\n    for (var KEY = 0; KEY < ARR.length; KEY++) BODY;\\n  \");\n\n  var buildForOfLoose = template(\"\\n    for (var LOOP_OBJECT = OBJECT,\\n             IS_ARRAY = Array.isArray(LOOP_OBJECT),\\n             INDEX = 0,\\n             LOOP_OBJECT = IS_ARRAY ? LOOP_OBJECT : LOOP_OBJECT[Symbol.iterator]();;) {\\n      var ID;\\n      if (IS_ARRAY) {\\n        if (INDEX >= LOOP_OBJECT.length) break;\\n        ID = LOOP_OBJECT[INDEX++];\\n      } else {\\n        INDEX = LOOP_OBJECT.next();\\n        if (INDEX.done) break;\\n        ID = INDEX.value;\\n      }\\n    }\\n  \");\n\n  var buildForOf = template(\"\\n    var ITERATOR_COMPLETION = true;\\n    var ITERATOR_HAD_ERROR_KEY = false;\\n    var ITERATOR_ERROR_KEY = undefined;\\n    try {\\n      for (var ITERATOR_KEY = OBJECT[Symbol.iterator](), STEP_KEY; !(ITERATOR_COMPLETION = (STEP_KEY = ITERATOR_KEY.next()).done); ITERATOR_COMPLETION = true) {\\n      }\\n    } catch (err) {\\n      ITERATOR_HAD_ERROR_KEY = true;\\n      ITERATOR_ERROR_KEY = err;\\n    } finally {\\n      try {\\n        if (!ITERATOR_COMPLETION && ITERATOR_KEY.return) {\\n          ITERATOR_KEY.return();\\n        }\\n      } finally {\\n        if (ITERATOR_HAD_ERROR_KEY) {\\n          throw ITERATOR_ERROR_KEY;\\n        }\\n      }\\n    }\\n  \");\n\n\n  function _ForOfStatementArray(path) {\n    var node = path.node,\n        scope = path.scope;\n\n    var nodes = [];\n    var right = node.right;\n\n    if (!t.isIdentifier(right) || !scope.hasBinding(right.name)) {\n      var uid = scope.generateUidIdentifier(\"arr\");\n      nodes.push(t.variableDeclaration(\"var\", [t.variableDeclarator(uid, right)]));\n      right = uid;\n    }\n\n    var iterationKey = scope.generateUidIdentifier(\"i\");\n\n    var loop = buildForOfArray({\n      BODY: node.body,\n      KEY: iterationKey,\n      ARR: right\n    });\n\n    t.inherits(loop, node);\n    t.ensureBlock(loop);\n\n    var iterationValue = t.memberExpression(right, iterationKey, true);\n\n    var left = node.left;\n    if (t.isVariableDeclaration(left)) {\n      left.declarations[0].init = iterationValue;\n      loop.body.body.unshift(left);\n    } else {\n      loop.body.body.unshift(t.expressionStatement(t.assignmentExpression(\"=\", left, iterationValue)));\n    }\n\n    if (path.parentPath.isLabeledStatement()) {\n      loop = t.labeledStatement(path.parentPath.node.label, loop);\n    }\n\n    nodes.push(loop);\n\n    return nodes;\n  }\n\n  return {\n    visitor: {\n      ForOfStatement: function ForOfStatement(path, state) {\n        if (path.get(\"right\").isArrayExpression()) {\n          if (path.parentPath.isLabeledStatement()) {\n            return path.parentPath.replaceWithMultiple(_ForOfStatementArray(path));\n          } else {\n            return path.replaceWithMultiple(_ForOfStatementArray(path));\n          }\n        }\n\n        var callback = spec;\n        if (state.opts.loose) callback = loose;\n\n        var node = path.node;\n\n        var build = callback(path, state);\n        var declar = build.declar;\n        var loop = build.loop;\n        var block = loop.body;\n\n        path.ensureBlock();\n\n        if (declar) {\n          block.body.push(declar);\n        }\n\n        block.body = block.body.concat(node.body.body);\n\n        t.inherits(loop, node);\n        t.inherits(loop.body, node.body);\n\n        if (build.replaceParent) {\n          path.parentPath.replaceWithMultiple(build.node);\n          path.remove();\n        } else {\n          path.replaceWithMultiple(build.node);\n        }\n      }\n    }\n  };\n\n  function loose(path, file) {\n    var node = path.node,\n        scope = path.scope,\n        parent = path.parent;\n    var left = node.left;\n\n    var declar = void 0,\n        id = void 0;\n\n    if (t.isIdentifier(left) || t.isPattern(left) || t.isMemberExpression(left)) {\n      id = left;\n    } else if (t.isVariableDeclaration(left)) {\n      id = scope.generateUidIdentifier(\"ref\");\n      declar = t.variableDeclaration(left.kind, [t.variableDeclarator(left.declarations[0].id, id)]);\n    } else {\n      throw file.buildCodeFrameError(left, messages.get(\"unknownForHead\", left.type));\n    }\n\n    var iteratorKey = scope.generateUidIdentifier(\"iterator\");\n    var isArrayKey = scope.generateUidIdentifier(\"isArray\");\n\n    var loop = buildForOfLoose({\n      LOOP_OBJECT: iteratorKey,\n      IS_ARRAY: isArrayKey,\n      OBJECT: node.right,\n      INDEX: scope.generateUidIdentifier(\"i\"),\n      ID: id\n    });\n\n    if (!declar) {\n      loop.body.body.shift();\n    }\n\n    var isLabeledParent = t.isLabeledStatement(parent);\n    var labeled = void 0;\n\n    if (isLabeledParent) {\n      labeled = t.labeledStatement(parent.label, loop);\n    }\n\n    return {\n      replaceParent: isLabeledParent,\n      declar: declar,\n      node: labeled || loop,\n      loop: loop\n    };\n  }\n\n  function spec(path, file) {\n    var node = path.node,\n        scope = path.scope,\n        parent = path.parent;\n\n    var left = node.left;\n    var declar = void 0;\n\n    var stepKey = scope.generateUidIdentifier(\"step\");\n    var stepValue = t.memberExpression(stepKey, t.identifier(\"value\"));\n\n    if (t.isIdentifier(left) || t.isPattern(left) || t.isMemberExpression(left)) {\n      declar = t.expressionStatement(t.assignmentExpression(\"=\", left, stepValue));\n    } else if (t.isVariableDeclaration(left)) {\n      declar = t.variableDeclaration(left.kind, [t.variableDeclarator(left.declarations[0].id, stepValue)]);\n    } else {\n      throw file.buildCodeFrameError(left, messages.get(\"unknownForHead\", left.type));\n    }\n\n    var iteratorKey = scope.generateUidIdentifier(\"iterator\");\n\n    var template = buildForOf({\n      ITERATOR_HAD_ERROR_KEY: scope.generateUidIdentifier(\"didIteratorError\"),\n      ITERATOR_COMPLETION: scope.generateUidIdentifier(\"iteratorNormalCompletion\"),\n      ITERATOR_ERROR_KEY: scope.generateUidIdentifier(\"iteratorError\"),\n      ITERATOR_KEY: iteratorKey,\n      STEP_KEY: stepKey,\n      OBJECT: node.right,\n      BODY: null\n    });\n\n    var isLabeledParent = t.isLabeledStatement(parent);\n\n    var tryBody = template[3].block.body;\n    var loop = tryBody[0];\n\n    if (isLabeledParent) {\n      tryBody[0] = t.labeledStatement(parent.label, loop);\n    }\n\n    return {\n      replaceParent: isLabeledParent,\n      declar: declar,\n      loop: loop,\n      node: template\n    };\n  }\n};\n\nmodule.exports = exports[\"default\"];"]}